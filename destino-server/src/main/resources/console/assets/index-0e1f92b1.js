import{u as te,_ as se}from"./refresh-5c3294a7.js";import{_ as ne,a as oe}from"./round-plus-b768a0d0.js";import{d as H,ap as O,bx as W,bY as F,bZ as L,r as v,aT as V,k as $,i as le,ak as M,aw as G,ar as i,aq as e,at as t,a4 as y,as as C,an as z,b_ as ie,b$ as ce,aB as re,bG as de,bF as pe,aC as me,o as ue,bI as _e,al as fe,a1 as ge,au as be,aA as he,bJ as ve,b4 as ye,c0 as Te,bE as xe}from"./index-14be5eda.js";import{u as we,_ as Se}from"./use-table-height-bb0e75b4.js";import{c as Ne}from"./rule-890934cc.js";import{_ as D}from"./Space-6bd69fc7.js";import{_ as ke}from"./Input-3ed2969b.js";import{a as De}from"./Grid-b7828565.js";import{a as Ce}from"./FormItem-7cb46c99.js";import{_ as ze}from"./Time-69247b8e.js";import{N as Ae}from"./GradientText-e0a89834.js";import"./Checkbox-e432fb9b.js";import"./Dropdown-be157d33.js";import"./Select-fe2401fd.js";const Re=H({name:"NamespaceActionModal",__name:"action-modal",props:{visible:{type:Boolean},type:{default:"add"},editData:{default:null}},emits:["update:visible","refresh-table"],setup(b,{emit:s}){const o=b,{t:n}=O(),{clear:A}=W(),{clear:R}=F(),{clear:E}=L(),I={name:Ne(()=>n("message.namespace.name"))},S=v(),l=V(P()),g=$({get(){return o.visible},set(c){s("update:visible",c)}}),N=$(()=>({add:n("message.namespace.addTitle"),edit:n("message.namespace.updateTitle")})[o.type]);function h(){g.value=!1}function P(){return{name:"",desc:""}}function U(){({add:()=>{l.name="",l.desc=""},edit:()=>{o.editData&&(l.name=o.editData.name,l.desc=o.editData.desc)}})[o.type]()}async function T(){var c,r,f;if(await((c=S.value)==null?void 0:c.validate()),o.type==="add"){const{error:m}=await ie(l);m||((r=window.$message)==null||r.success(n("message.operation.addSuccess")),x(),s("refresh-table"),h())}else if(o.editData){const{error:m}=await ce(o.editData.name,{desc:l.desc});m||((f=window.$message)==null||f.success(n("message.operation.updateSuccess")),x(),s("refresh-table"),h())}}function x(){A(),R(),E()}return le(()=>o.visible,c=>{c&&U()}),(c,r)=>{const f=ke,m=ne,k=De,B=Ce,w=re;return M(),G(w,{show:g.value,"onUpdate:show":r[2]||(r[2]=p=>g.value=p),preset:"card",title:N.value,class:"w-500px"},{default:i(()=>[e(B,{ref_key:"formRef",ref:S,"label-placement":"left","label-align":"left","label-width":"auto",model:l,rules:I},{default:i(()=>[e(k,{cols:12,"x-gap":18},{default:i(()=>[e(m,{span:12,label:t(n)("message.namespace.name"),path:"name"},{default:i(()=>[e(f,{value:l.name,"onUpdate:value":r[0]||(r[0]=p=>l.name=p),disabled:o.type==="edit",maxlength:"200",placeholder:t(n)("message.namespace.namePlaceholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),e(m,{span:12,label:t(n)("message.namespace.desc"),path:"desc"},{default:i(()=>[e(f,{value:l.desc,"onUpdate:value":r[1]||(r[1]=p=>l.desc=p),type:"textarea",maxlength:"2000",placeholder:t(n)("message.namespace.descPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e(t(D),{class:"w-full pt-16px",size:24,justify:"end"},{default:i(()=>[e(t(y),{onClick:h},{default:i(()=>[C(z(t(n)("message.operation.cancel")),1)]),_:1}),e(t(y),{type:"primary","attr-type":"submit",onClick:T},{default:i(()=>[C(z(t(n)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ee={class:"h-full overflow-hidden"};function j(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!xe(b)}const qe=H({__name:"index",setup(b){const{t:s}=O(),{warning:o}=de(),{hasPermission:n}=pe(),{clear:A}=W(),{clear:R,loadNamespaces:E}=F(),{clear:I}=L(),{tableHeight:S,initTableHeight:l}=we(),{bool:g,setTrue:N}=me(),{loading:h,startLoading:P,endLoading:U}=te(!1),T=v("add"),x=v(null),c=v(),r=v([]),f=[],m=n("WRITE","AUTHENTICATION"),k=n("DELETE","AUTHENTICATION");if(m||k){const a=d=>{let _;return e(y,{size:"small",onClick:()=>Y(d)},j(_=s("message.operation.update"))?_:{default:()=>[_]})},u=d=>{let _;return e(y,{size:"small",onClick:()=>Z(d.name),disabled:d.fixed},j(_=s("message.operation.delete"))?_:{default:()=>[_]})};f.push({key:"actions",title:()=>s("message.table.operation"),align:"center",width:200,render:d=>e(D,{justify:"center"},{default:()=>[m?a(d):"",k?u(d):""]})})}const B=v([{key:"name",title:()=>s("message.namespace.name"),align:"center",minWidth:100,resizable:!0,ellipsis:{tooltip:!0},render:a=>e(Ae,null,{default:()=>[a.name]})},{key:"desc",title:()=>s("message.namespace.desc"),align:"center",resizable:!0,minWidth:100,ellipsis:{tooltip:!0}},{key:"createTime",title:()=>s("message.namespace.createTime"),align:"center",width:200,render:a=>!a.createTime||a.createTime<=0?"":e(ze,{time:a.createTime},null)},...f]),w=V({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:a=>{w.page=a},onUpdatePageSize:a=>{w.pageSize=a}});ue(()=>{l(c),p()});async function p(){P();const a=await E();q(a),U()}function q(a){r.value=a.map(u=>({...u,key:u.name}))}function J(){T.value="add",N()}function Y(a){T.value="edit",x.value=a,N()}async function Z(a){o({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var d;const{error:u}=await Te(a);u||(K(),(d=window.$message)==null||d.success(s("message.operation.deleteSuccess")),p())}})}function K(){A(),R(),I()}return(a,u)=>{const d=oe,_=se,Q=Se,X=ye,ee=_e("permission");return M(),fe("div",Ee,[e(X,{bordered:!1,class:"rounded-8px shadow-sm"},{default:i(()=>[e(t(D),{class:"pb-12px",justify:"space-between"},{default:i(()=>[ge((M(),G(t(y),{type:"primary",onClick:J},{default:i(()=>[e(d,{class:"mr-4px text-20px"}),C(" "+z(t(s)("message.operation.add")),1)]),_:1})),[[ee,["WRITE","REGISTRATION"]]]),e(t(D),{align:"center",size:18},{default:i(()=>[e(t(y),{size:"small",type:"primary",onClick:p},{default:i(()=>[e(_,{class:be(["mr-4px text-16px",{"animate-spin":t(h)}])},null,8,["class"]),C(" "+z(t(s)("message.table.refresh")),1)]),_:1})]),_:1})]),_:1}),e(Q,{ref_key:"tableRef",ref:c,columns:B.value,data:r.value,loading:t(h),pagination:w,style:he({height:`${t(S)}px`}),"flex-height":""},null,8,["columns","data","loading","pagination","style"]),e(Re,{visible:t(g),"onUpdate:visible":u[0]||(u[0]=ae=>ve(g)?g.value=ae:null),type:T.value,"edit-data":x.value,onRefreshTable:p},null,8,["visible","type","edit-data"])]),_:1})])}}});export{qe as default};
