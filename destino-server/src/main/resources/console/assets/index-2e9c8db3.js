import{u as te,_ as se}from"./refresh-27f42263.js";import{_ as ne,a as oe}from"./round-plus-e2e534e6.js";import{d as $,ag as O,bm as H,bM as L,bN as V,r as v,aJ as F,j as B,i as le,ab as j,an as G,ai as i,ah as e,ak as t,_ as y,aj as C,ae as z,bO as ie,bP as ce,as as re,bu as de,bt as me,at as pe,o as ue,bw as _e,ac as fe,W as ge,al as be,ar as he,bx as ve,aW as ye,bQ as Te,bs as xe}from"./index-0246bf31.js";import{u as we,_ as Ne}from"./use-table-height-f39d900f.js";import{c as Se}from"./rule-9c60485b.js";import{_ as k}from"./Space-5a2962b0.js";import{_ as De}from"./Input-8d4ddc63.js";import{a as ke}from"./Grid-9c6a017c.js";import{a as Ce}from"./FormItem-f0746795.js";import{_ as ze}from"./Time-77a08d02.js";import{N as Re}from"./GradientText-57ed5542.js";import"./Checkbox-9a21cbd7.js";import"./Dropdown-38c02f7d.js";import"./Select-317eb937.js";const Ae=$({name:"NamespaceActionModal",__name:"action-modal",props:{visible:{type:Boolean},type:{default:"add"},editData:{default:null}},emits:["update:visible","refresh-table"],setup(b,{emit:s}){const o=b,{t:n}=O(),{clear:R}=H(),{clear:A}=L(),{clear:P}=V(),E={name:Se(()=>n("message.namespace.name"))},N=v(),l=F(I()),g=B({get(){return o.visible},set(c){s("update:visible",c)}}),S=B(()=>({add:n("message.namespace.addTitle"),edit:n("message.namespace.updateTitle")})[o.type]);function h(){g.value=!1}function I(){return{name:"",desc:""}}function M(){({add:()=>{l.name="",l.desc=""},edit:()=>{o.editData&&(l.name=o.editData.name,l.desc=o.editData.desc)}})[o.type]()}async function T(){var c,r,f;if(await((c=N.value)==null?void 0:c.validate()),o.type==="add"){const{error:p}=await ie(l);p||((r=window.$message)==null||r.success(n("message.operation.addSuccess")),x(),s("refresh-table"),h())}else if(o.editData){const{error:p}=await ce(o.editData.name,{desc:l.desc});p||((f=window.$message)==null||f.success(n("message.operation.updateSuccess")),x(),s("refresh-table"),h())}}function x(){R(),A(),P()}return le(()=>o.visible,c=>{c&&M()}),(c,r)=>{const f=De,p=ne,D=ke,U=Ce,w=re;return j(),G(w,{show:g.value,"onUpdate:show":r[2]||(r[2]=m=>g.value=m),preset:"card",title:S.value,class:"w-500px"},{default:i(()=>[e(U,{ref_key:"formRef",ref:N,"label-placement":"left","label-align":"left","label-width":"auto",model:l,rules:E},{default:i(()=>[e(D,{cols:12,"x-gap":18},{default:i(()=>[e(p,{span:12,label:t(n)("message.namespace.name"),path:"name"},{default:i(()=>[e(f,{value:l.name,"onUpdate:value":r[0]||(r[0]=m=>l.name=m),disabled:o.type==="edit",maxlength:"200",placeholder:t(n)("message.namespace.namePlaceholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),e(p,{span:12,label:t(n)("message.namespace.desc"),path:"desc"},{default:i(()=>[e(f,{value:l.desc,"onUpdate:value":r[1]||(r[1]=m=>l.desc=m),type:"textarea",maxlength:"2000",placeholder:t(n)("message.namespace.descPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e(t(k),{class:"w-full pt-16px",size:24,justify:"end"},{default:i(()=>[e(t(y),{onClick:h},{default:i(()=>[C(z(t(n)("message.operation.cancel")),1)]),_:1}),e(t(y),{type:"primary","attr-type":"submit",onClick:T},{default:i(()=>[C(z(t(n)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Pe={class:"h-full overflow-hidden"};function W(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!xe(b)}const qe=$({__name:"index",setup(b){const{t:s}=O(),{warning:o}=de(),{hasPermission:n}=me(),{clear:R}=H(),{clear:A,loadNamespaces:P}=L(),{clear:E}=V(),{tableHeight:N,initTableHeight:l}=we(),{bool:g,setTrue:S}=pe(),{loading:h,startLoading:I,endLoading:M}=te(!1),T=v("add"),x=v(null),c=v(),r=v([]),f=[],p=n("WRITE","AUTHENTICATION"),D=n("DELETE","AUTHENTICATION");if(p||D){const a=d=>{let _;return e(y,{size:"small",onClick:()=>Q(d)},W(_=s("message.operation.update"))?_:{default:()=>[_]})},u=d=>{let _;return e(y,{size:"small",onClick:()=>K(d.name),disabled:d.fixed},W(_=s("message.operation.delete"))?_:{default:()=>[_]})};f.push({key:"actions",title:()=>s("message.table.operation"),align:"center",width:200,render:d=>e(k,{justify:"center"},{default:()=>[p?a(d):"",D?u(d):""]})})}const U=v([{key:"name",title:()=>s("message.namespace.name"),align:"center",minWidth:100,resizable:!0,ellipsis:{tooltip:!0},render:a=>e(Re,null,{default:()=>[a.name]})},{key:"desc",title:()=>s("message.namespace.desc"),align:"center",resizable:!0,minWidth:100,ellipsis:{tooltip:!0}},{key:"createTime",title:()=>s("message.namespace.createTime"),align:"center",width:200,render:a=>!a.createTime||a.createTime<=0?"":e(ze,{time:a.createTime},null)},...f]),w=F({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:a=>{w.page=a},onUpdatePageSize:a=>{w.pageSize=a}});ue(()=>{l(c),m()});async function m(){I();const a=await P();q(a),M()}function q(a){r.value=a.map(u=>({...u,key:u.name}))}function J(){T.value="add",S()}function Q(a){T.value="edit",x.value=a,S()}async function K(a){o({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var d;const{error:u}=await Te(a);u||(X(),(d=window.$message)==null||d.success(s("message.operation.deleteSuccess")),m())}})}function X(){R(),A(),E()}return(a,u)=>{const d=oe,_=se,Y=Ne,Z=ye,ee=_e("permission");return j(),fe("div",Pe,[e(Z,{bordered:!1,class:"rounded-8px shadow-sm"},{default:i(()=>[e(t(k),{class:"pb-12px",justify:"space-between"},{default:i(()=>[ge((j(),G(t(y),{type:"primary",onClick:J},{default:i(()=>[e(d,{class:"mr-4px text-20px"}),C(" "+z(t(s)("message.operation.add")),1)]),_:1})),[[ee,["WRITE","REGISTRATION"]]]),e(t(k),{align:"center",size:18},{default:i(()=>[e(t(y),{size:"small",type:"primary",onClick:m},{default:i(()=>[e(_,{class:be(["mr-4px text-16px",{"animate-spin":t(h)}])},null,8,["class"]),C(" "+z(t(s)("message.table.refresh")),1)]),_:1})]),_:1})]),_:1}),e(Y,{ref_key:"tableRef",ref:c,columns:U.value,data:r.value,loading:t(h),pagination:w,style:he({height:`${t(N)}px`}),"flex-height":""},null,8,["columns","data","loading","pagination","style"]),e(Ae,{visible:t(g),"onUpdate:visible":u[0]||(u[0]=ae=>ve(g)?g.value=ae:null),type:T.value,"edit-data":x.value,onRefreshTable:m},null,8,["visible","type","edit-data"])]),_:1})])}}});export{qe as default};
