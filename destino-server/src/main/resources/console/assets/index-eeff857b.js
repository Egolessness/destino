import{u as ue,_ as pe}from"./refresh-27f42263.js";import{_ as me}from"./round-delete-f5c490d4.js";import{_ as _e,a as fe}from"./round-plus-e2e534e6.js";import{d as ae,ag as te,j as Y,r as C,aJ as q,aV as ge,i as he,ab as b,an as v,ai as i,ah as a,ak as o,ao as N,aj as I,ae as B,bA as be,bB as K,bC as we,bD as ve,bv as ye,aL as xe,_ as D,as as Te,at as Pe,bt as ke,bu as Ce,o as De,bE as Ue,bw as ze,ac as Ee,W as Z,al as Se,ar as Re,bx as Ne,bs as $e,bq as Ae,bF as Ie,aW as Be,bG as Le}from"./index-0246bf31.js";import{u as Me,_ as je}from"./use-table-height-f39d900f.js";import{f as Q,g as He}from"./rule-9c60485b.js";import{_ as Oe}from"./Input-8d4ddc63.js";import{_ as We,a as ee}from"./Select-317eb937.js";import{_ as Ve}from"./Switch-1f9b24fc.js";import{a as Fe}from"./Grid-9c6a017c.js";import{_ as A}from"./Space-5a2962b0.js";import{a as Ke}from"./FormItem-f0746795.js";import{_ as qe}from"./_plugin-vue_export-helper-c27b6911.js";import"./Checkbox-9a21cbd7.js";import"./Dropdown-38c02f7d.js";const Ge=ae({name:"UserActionModal",__name:"action-modal",props:{visible:{type:Boolean},type:{default:"add"},editData:{default:null}},emits:["update:visible","refresh-table"],setup(U,{emit:y}){const r=U,{t:l}=te(),x=Y({get(){return r.visible},set(d){y("update:visible",d)}}),w=()=>{x.value=!1},L=Y(()=>({add:l("message.user.addTitle"),edit:l("message.user.updateTitle"),changePwd:l("message.user.changePwdTitle")})[r.type]),M=C(),t=q(s()),T=q({options:[],loading:!1}),j={username:Q.username,password:Q.pwd,confirmPassword:He(ge(t).password),email:Q.email};function s(){return{username:"",password:"",confirmPassword:"",roles:[],email:"",activated:!0}}function h(d){Object.assign(t,d)}function H(){({add:()=>{h({username:"",password:"",confirmPassword:"",email:"",activated:!0,roles:[]})},edit:()=>{r.editData&&h(r.editData)},changePwd:()=>{var n;return h({username:(n=r.editData)==null?void 0:n.username,password:"",confirmPassword:""})}})[r.type]()}async function z(){var n,_,f,P;await((n=M.value)==null?void 0:n.validate());let d;switch(r.type){case"edit":if(!r.editData)return;d=await ve(r.editData.id,{email:t.email,roles:t.roles,activated:t.activated}),d.error||((_=window.$message)==null||_.success(l("message.operation.updateSuccess")),y("refresh-table"),w());break;case"changePwd":if(!r.editData)return;d=await we(r.editData.id,{password:K(t.username+t.password),confirmPassword:K(t.username+t.confirmPassword)}),d.error||((f=window.$message)==null||f.success(l("message.operation.updateSuccess")),y("refresh-table"),w());break;default:d=await be({...t,password:K(t.username+t.password),confirmPassword:K(t.username+t.confirmPassword)}),d.error||((P=window.$message)==null||P.success(l("message.operation.addSuccess")),y("refresh-table"),w())}}function E(d){T.loading=!0,ye({name:d,page:0,size:200}).then(n=>{T.loading=!1,n.data&&(T.options=n.data.records.map(_=>({label:_.name,value:_.name})))})}return he(()=>r.visible,d=>{d&&(E(),H())}),(d,n)=>{const _=Oe,f=_e,P=We,O=xe,W=Ve,S=Fe,V=D,G=A,F=Ke,J=Te;return b(),v(J,{show:x.value,"onUpdate:show":n[6]||(n[6]=m=>x.value=m),preset:"card",title:L.value,class:"w-500px"},{default:i(()=>[a(F,{ref_key:"formRef",ref:M,"label-placement":"left","label-align":"left","label-width":"auto",model:t,rules:j},{default:i(()=>[a(S,{cols:12,"x-gap":18},{default:i(()=>[a(f,{span:12,label:o(l)("message.user.username"),path:"username"},{default:i(()=>[a(_,{value:t.username,"onUpdate:value":n[0]||(n[0]=m=>t.username=m),disabled:r.type!=="add",maxlength:"50",placeholder:o(l)("message.login.username.placeholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),r.type!="edit"?(b(),v(f,{key:0,span:12,label:o(l)("message.user.password"),path:"password"},{default:i(()=>[a(_,{value:t.password,"onUpdate:value":n[1]||(n[1]=m=>t.password=m),type:"password",maxlength:"18",minlength:"5","show-password-on":"mousedown",placeholder:o(l)("message.login.password.placeholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):N("",!0),r.type!="edit"?(b(),v(f,{key:1,span:12,label:o(l)("message.user.confirmPassword._value"),path:"confirmPassword"},{default:i(()=>[a(_,{value:t.confirmPassword,"onUpdate:value":n[2]||(n[2]=m=>t.confirmPassword=m),type:"password",maxlength:"18",minlength:"5","show-password-on":"mousedown",placeholder:o(l)("message.user.confirmPassword.placeholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):N("",!0),r.type!="changePwd"?(b(),v(f,{key:2,span:12,label:o(l)("message.role.roles"),path:"roles"},{default:i(()=>[a(P,{value:t.roles,"onUpdate:value":n[3]||(n[3]=m=>t.roles=m),multiple:"",filterable:"",placeholder:o(l)("message.role.search"),options:T.options,loading:T.loading,clearable:"",remote:"","clear-filter-after-select":!1,onSearch:E},null,8,["value","placeholder","options","loading"])]),_:1},8,["label"])):N("",!0),r.type!="changePwd"?(b(),v(f,{key:3,span:12,label:o(l)("message.user.email._value"),path:"email"},{default:i(()=>[a(_,{value:t.email,"onUpdate:value":n[4]||(n[4]=m=>t.email=m),maxlength:"50",placeholder:o(l)("message.user.email.placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):N("",!0),r.type!="changePwd"?(b(),v(f,{key:4,span:12,label:o(l)("message.user.enabled"),path:"activated"},{default:i(()=>[a(W,{value:t.activated,"onUpdate:value":n[5]||(n[5]=m=>t.activated=m),size:"large"},{"checked-icon":i(()=>[a(O,{icon:"smile-wink"})]),"unchecked-icon":i(()=>[a(O,{icon:"face-sad-cry"})]),_:1},8,["value"])]),_:1},8,["label"])):N("",!0)]),_:1}),a(G,{class:"w-full pt-16px",size:24,justify:"end"},{default:i(()=>[a(V,{onClick:w},{default:i(()=>[I(B(o(l)("message.operation.cancel")),1)]),_:1}),a(V,{type:"primary","attr-type":"submit",onClick:z},{default:i(()=>[I(B(o(l)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Je={class:"h-full overflow-hidden"};function $(U){return typeof U=="function"||Object.prototype.toString.call(U)==="[object Object]"&&!$e(U)}const Qe=ae({__name:"index",setup(U){const{loading:y,startLoading:r,endLoading:l}=ue(!1),{bool:x,setTrue:w}=Pe(),{hasPermission:L,isCurrentLogin:M}=ke(),{tableHeight:t,initTableHeight:T}=Me(),{warning:j}=Ce(),{t:s}=te(),h=q({username:"",email:"",page:0,size:10}),H=C([]),z=C([]),E=C(),d=C(null),n=C("add"),_=[],f=L("WRITE","AUTHENTICATION"),P=L("DELETE","AUTHENTICATION");if(f||P){const e=u=>{let p;return a(D,{size:"small",disabled:u.fixed,onClick:()=>m(u)},$(p=s("message.operation.update"))?p:{default:()=>[p]})},c=u=>{let p;return a(D,{size:"small",disabled:u.fixed&&!M(u.username),onClick:()=>se(u)},$(p=s("message.operation.changePwd"))?p:{default:()=>[p]})},g=u=>{let p;return a(D,{size:"small",onClick:()=>ne(u.id),disabled:u.fixed},$(p=s("message.operation.delete"))?p:{default:()=>[p]})};_.push({key:"actions",title:()=>s("message.table.operation"),align:"center",width:320,render:u=>a(A,{justify:"center"},{default:()=>[f?e(u):"",f?c(u):"",P?g(u):""]})})}const O=C([{type:"selection",align:"center"},{key:"username",title:()=>s("message.user.username"),align:"center",resizable:!0,ellipsis:{tooltip:!0}},{key:"email",title:()=>s("message.user.email._value"),align:"center",resizable:!0,maxWidth:300,ellipsis:{tooltip:!0}},{key:"roles",title:()=>s("message.role.roles"),align:"center",resizable:!0,minWidth:100,ellipsis:{tooltip:!0},render:e=>e.roles?e.roles.map(c=>a(ee,{round:!0,bordered:!1,type:"primary",size:"small",class:"ml-2px mr-2px"},$(c)?c:{default:()=>[c]})):""},{key:"activated",title:()=>s("message.table.status"),align:"center",resizable:!0,width:140,render:e=>{let c;const g=p=>p?"success":"default",u=p=>s(p?"message.user.activated":"message.user.inactivated");return a(ee,{type:g(e.activated)},$(c=u(e.activated))?c:{default:()=>[c]})}},..._]);De(()=>{T(E)});function W(e){H.value=e.map(c=>(c.key=c.id,c))}function S(e){n.value=e}function V(e){z.value=e}function G(e){return e.activated?"":"account-disabled"}function F(e){d.value=e}function J(){S("add"),w()}function m(e){F(e),S("edit"),w()}function se(e){F(e),S("changePwd"),w()}async function ne(e){j({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var g;const{error:c}=await Le(e);c||((g=window.$message)==null||g.success(s("message.operation.deleteSuccess")),k())}})}async function oe(){var e;if(Ae(z.value)){(e=window.$message)==null||e.warning(s("message.tip.noSelected"));return}j({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var g;const{error:c}=await Ie(z.value);c||((g=window.$message)==null||g.success(s("message.operation.deleteSuccess")),k())}})}const R=q({page:1,pageSize:h.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:e=>{R.page=e,h.page=e-1,k()},onUpdatePageSize:e=>{h.size!==e&&(R.pageSize=e,R.page=1,h.size=e,h.page=0,k())}});function le(e){R.itemCount=e.total}async function k(){r();const{data:e}=await Ue(h);e?(W(e.records),le(e)):W([]),l()}function ie(){k()}return ie(),(e,c)=>{const g=fe,u=me,p=pe,re=je,de=Be,X=ze("permission");return b(),Ee("div",Je,[a(de,{bordered:!1,class:"rounded-8px shadow-sm"},{default:i(()=>[a(o(A),{class:"pb-12px",justify:"space-between"},{default:i(()=>[a(o(A),null,{default:i(()=>[Z((b(),v(o(D),{type:"primary",onClick:J},{default:i(()=>[a(g,{class:"mr-4px text-20px"}),I(" "+B(o(s)("message.operation.add")),1)]),_:1})),[[X,["WRITE","AUTHENTICATION"]]]),Z((b(),v(o(D),{type:"error",onClick:oe},{default:i(()=>[a(u,{class:"mr-4px text-20px"}),I(" "+B(o(s)("message.operation.delete")),1)]),_:1})),[[X,["DELETE","AUTHENTICATION"]]])]),_:1}),a(o(A),{align:"center",size:18},{default:i(()=>[a(o(D),{size:"small",type:"primary",onClick:k},{default:i(()=>[a(p,{class:Se(["mr-4px text-16px",{"animate-spin":o(y)}])},null,8,["class"]),I(" "+B(o(s)("message.table.refresh")),1)]),_:1})]),_:1})]),_:1}),a(re,{ref_key:"tableRef",ref:E,columns:O.value,data:H.value,loading:o(y),pagination:R,style:Re({height:`${o(t)}px`}),"row-class-name":G,"flex-height":"",remote:"","onUpdate:checkedRowKeys":V},null,8,["columns","data","loading","pagination","style"]),a(Ge,{visible:o(x),"onUpdate:visible":c[0]||(c[0]=ce=>Ne(x)?x.value=ce:null),type:n.value,"edit-data":d.value,onRefreshTable:k},null,8,["visible","type","edit-data"])]),_:1})])}}});const pa=qe(Qe,[["__scopeId","data-v-46c54d59"]]);export{pa as default};
