import{u as ue,_ as pe}from"./refresh-5c3294a7.js";import{_ as me}from"./round-delete-a68c21bd.js";import{_ as _e,a as fe}from"./round-plus-b768a0d0.js";import{d as ae,ap as te,k as Y,r as C,aT as Q,b3 as ge,i as be,ak as h,aw as v,ar as i,aq as a,at as o,ax as N,as as A,an as B,bM as he,bN as K,bO as we,bP as ve,bH as ye,aV as xe,a4 as D,aB as Te,aC as Pe,bF as ke,bG as Ce,o as De,bQ as Ue,bI as ze,al as Se,a1 as Z,au as Ee,aA as Re,bJ as Ne,bE as Ie,bB as $e,bR as Ae,b4 as Be,bS as Me}from"./index-14be5eda.js";import{u as Le,_ as He}from"./use-table-height-bb0e75b4.js";import{f as J,g as Oe}from"./rule-890934cc.js";import{_ as je}from"./Input-3ed2969b.js";import{_ as Ve,a as ee}from"./Select-fe2401fd.js";import{_ as We}from"./Switch-1c9e2bf5.js";import{a as Fe}from"./Grid-b7828565.js";import{_ as $}from"./Space-6bd69fc7.js";import{a as Ke}from"./FormItem-7cb46c99.js";import{_ as Qe}from"./_plugin-vue_export-helper-c27b6911.js";import"./Checkbox-e432fb9b.js";import"./Dropdown-be157d33.js";const qe=ae({name:"UserActionModal",__name:"action-modal",props:{visible:{type:Boolean},type:{default:"add"},editData:{default:null}},emits:["update:visible","refresh-table"],setup(U,{emit:y}){const r=U,{t:l}=te(),x=Y({get(){return r.visible},set(d){y("update:visible",d)}}),w=()=>{x.value=!1},M=Y(()=>({add:l("message.user.addTitle"),edit:l("message.user.updateTitle"),changePwd:l("message.user.changePwdTitle")})[r.type]),L=C(),t=Q(s()),T=Q({options:[],loading:!1}),H={username:J.username,password:J.pwd,confirmPassword:Oe(ge(t).password),email:J.email};function s(){return{username:"",password:"",confirmPassword:"",roles:[],email:"",activated:!0}}function b(d){Object.assign(t,d)}function O(){({add:()=>{b({username:"",password:"",confirmPassword:"",email:"",activated:!0,roles:[]})},edit:()=>{r.editData&&b(r.editData)},changePwd:()=>{var n;return b({username:(n=r.editData)==null?void 0:n.username,password:"",confirmPassword:""})}})[r.type]()}async function z(){var n,_,f,P;await((n=L.value)==null?void 0:n.validate());let d;switch(r.type){case"edit":if(!r.editData)return;d=await ve(r.editData.id,{email:t.email,roles:t.roles,activated:t.activated}),d.error||((_=window.$message)==null||_.success(l("message.operation.updateSuccess")),y("refresh-table"),w());break;case"changePwd":if(!r.editData)return;d=await we(r.editData.id,{password:K(t.username+t.password),confirmPassword:K(t.username+t.confirmPassword)}),d.error||((f=window.$message)==null||f.success(l("message.operation.updateSuccess")),y("refresh-table"),w());break;default:d=await he({...t,password:K(t.username+t.password),confirmPassword:K(t.username+t.confirmPassword)}),d.error||((P=window.$message)==null||P.success(l("message.operation.addSuccess")),y("refresh-table"),w())}}function S(d){T.loading=!0,ye({name:d,page:0,size:200}).then(n=>{T.loading=!1,n.data&&(T.options=n.data.records.map(_=>({label:_.name,value:_.name})))})}return be(()=>r.visible,d=>{d&&(S(),O())}),(d,n)=>{const _=je,f=_e,P=Ve,j=xe,V=We,E=Fe,W=D,q=$,F=Ke,G=Te;return h(),v(G,{show:x.value,"onUpdate:show":n[6]||(n[6]=m=>x.value=m),preset:"card",title:M.value,class:"w-500px"},{default:i(()=>[a(F,{ref_key:"formRef",ref:L,"label-placement":"left","label-align":"left","label-width":"auto",model:t,rules:H},{default:i(()=>[a(E,{cols:12,"x-gap":18},{default:i(()=>[a(f,{span:12,label:o(l)("message.user.username"),path:"username"},{default:i(()=>[a(_,{value:t.username,"onUpdate:value":n[0]||(n[0]=m=>t.username=m),disabled:r.type!=="add",maxlength:"50",placeholder:o(l)("message.login.username.placeholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),r.type!="edit"?(h(),v(f,{key:0,span:12,label:o(l)("message.user.password"),path:"password"},{default:i(()=>[a(_,{value:t.password,"onUpdate:value":n[1]||(n[1]=m=>t.password=m),type:"password",maxlength:"18",minlength:"5","show-password-on":"mousedown",placeholder:o(l)("message.login.password.placeholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):N("",!0),r.type!="edit"?(h(),v(f,{key:1,span:12,label:o(l)("message.user.confirmPassword._value"),path:"confirmPassword"},{default:i(()=>[a(_,{value:t.confirmPassword,"onUpdate:value":n[2]||(n[2]=m=>t.confirmPassword=m),type:"password",maxlength:"18",minlength:"5","show-password-on":"mousedown",placeholder:o(l)("message.user.confirmPassword.placeholder"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])):N("",!0),r.type!="changePwd"?(h(),v(f,{key:2,span:12,label:o(l)("message.role.roles"),path:"roles"},{default:i(()=>[a(P,{value:t.roles,"onUpdate:value":n[3]||(n[3]=m=>t.roles=m),multiple:"",filterable:"",placeholder:o(l)("message.role.search"),options:T.options,loading:T.loading,clearable:"",remote:"","clear-filter-after-select":!1,onSearch:S},null,8,["value","placeholder","options","loading"])]),_:1},8,["label"])):N("",!0),r.type!="changePwd"?(h(),v(f,{key:3,span:12,label:o(l)("message.user.email._value"),path:"email"},{default:i(()=>[a(_,{value:t.email,"onUpdate:value":n[4]||(n[4]=m=>t.email=m),maxlength:"50",placeholder:o(l)("message.user.email.placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"])):N("",!0),r.type!="changePwd"?(h(),v(f,{key:4,span:12,label:o(l)("message.user.enabled"),path:"activated"},{default:i(()=>[a(V,{value:t.activated,"onUpdate:value":n[5]||(n[5]=m=>t.activated=m),size:"large"},{"checked-icon":i(()=>[a(j,{icon:"smile-wink"})]),"unchecked-icon":i(()=>[a(j,{icon:"face-sad-cry"})]),_:1},8,["value"])]),_:1},8,["label"])):N("",!0)]),_:1}),a(q,{class:"w-full pt-16px",size:24,justify:"end"},{default:i(()=>[a(W,{onClick:w},{default:i(()=>[A(B(o(l)("message.operation.cancel")),1)]),_:1}),a(W,{type:"primary","attr-type":"submit",onClick:z},{default:i(()=>[A(B(o(l)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),Ge={class:"h-full overflow-hidden"};function I(U){return typeof U=="function"||Object.prototype.toString.call(U)==="[object Object]"&&!Ie(U)}const Je=ae({__name:"index",setup(U){const{loading:y,startLoading:r,endLoading:l}=ue(!1),{bool:x,setTrue:w}=Pe(),{hasPermission:M,isCurrentLogin:L}=ke(),{tableHeight:t,initTableHeight:T}=Le(),{warning:H}=Ce(),{t:s}=te(),b=Q({username:"",email:"",page:0,size:10}),O=C([]),z=C([]),S=C(),d=C(null),n=C("add"),_=[],f=M("WRITE","AUTHENTICATION"),P=M("DELETE","AUTHENTICATION");if(f||P){const e=u=>{let p;return a(D,{size:"small",disabled:u.fixed,onClick:()=>m(u)},I(p=s("message.operation.update"))?p:{default:()=>[p]})},c=u=>{let p;return a(D,{size:"small",disabled:u.fixed&&!L(u.username),onClick:()=>se(u)},I(p=s("message.operation.changePwd"))?p:{default:()=>[p]})},g=u=>{let p;return a(D,{size:"small",onClick:()=>ne(u.id),disabled:u.fixed},I(p=s("message.operation.delete"))?p:{default:()=>[p]})};_.push({key:"actions",title:()=>s("message.table.operation"),align:"center",width:320,render:u=>a($,{justify:"center"},{default:()=>[f?e(u):"",f?c(u):"",P?g(u):""]})})}const j=C([{type:"selection",align:"center"},{key:"username",title:()=>s("message.user.username"),align:"center",resizable:!0,ellipsis:{tooltip:!0}},{key:"email",title:()=>s("message.user.email._value"),align:"center",resizable:!0,maxWidth:300,ellipsis:{tooltip:!0}},{key:"roles",title:()=>s("message.role.roles"),align:"center",resizable:!0,minWidth:100,ellipsis:{tooltip:!0},render:e=>e.roles?e.roles.map(c=>a(ee,{round:!0,bordered:!1,type:"primary",size:"small",class:"ml-2px mr-2px"},I(c)?c:{default:()=>[c]})):""},{key:"activated",title:()=>s("message.table.status"),align:"center",resizable:!0,width:140,render:e=>{let c;const g=p=>p?"success":"default",u=p=>s(p?"message.user.activated":"message.user.inactivated");return a(ee,{type:g(e.activated)},I(c=u(e.activated))?c:{default:()=>[c]})}},..._]);De(()=>{T(S)});function V(e){O.value=e.map(c=>(c.key=c.id,c))}function E(e){n.value=e}function W(e){z.value=e}function q(e){return e.activated?"":"account-disabled"}function F(e){d.value=e}function G(){E("add"),w()}function m(e){F(e),E("edit"),w()}function se(e){F(e),E("changePwd"),w()}async function ne(e){H({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var g;const{error:c}=await Me(e);c||((g=window.$message)==null||g.success(s("message.operation.deleteSuccess")),k())}})}async function oe(){var e;if($e(z.value)){(e=window.$message)==null||e.warning(s("message.tip.noSelected"));return}H({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var g;const{error:c}=await Ae(z.value);c||((g=window.$message)==null||g.success(s("message.operation.deleteSuccess")),k())}})}const R=Q({page:1,pageSize:b.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:e=>{R.page=e,b.page=e-1,k()},onUpdatePageSize:e=>{b.size!==e&&(R.pageSize=e,R.page=1,b.size=e,b.page=0,k())}});function le(e){R.itemCount=e.total}async function k(){r();const{data:e}=await Ue(b);e?(V(e.records),le(e)):V([]),l()}function ie(){k()}return ie(),(e,c)=>{const g=fe,u=me,p=pe,re=He,de=Be,X=ze("permission");return h(),Se("div",Ge,[a(de,{bordered:!1,class:"rounded-8px shadow-sm"},{default:i(()=>[a(o($),{class:"pb-12px",justify:"space-between"},{default:i(()=>[a(o($),null,{default:i(()=>[Z((h(),v(o(D),{type:"primary",onClick:G},{default:i(()=>[a(g,{class:"mr-4px text-20px"}),A(" "+B(o(s)("message.operation.add")),1)]),_:1})),[[X,["WRITE","AUTHENTICATION"]]]),Z((h(),v(o(D),{type:"error",onClick:oe},{default:i(()=>[a(u,{class:"mr-4px text-20px"}),A(" "+B(o(s)("message.operation.delete")),1)]),_:1})),[[X,["DELETE","AUTHENTICATION"]]])]),_:1}),a(o($),{align:"center",size:18},{default:i(()=>[a(o(D),{size:"small",type:"primary",onClick:k},{default:i(()=>[a(p,{class:Ee(["mr-4px text-16px",{"animate-spin":o(y)}])},null,8,["class"]),A(" "+B(o(s)("message.table.refresh")),1)]),_:1})]),_:1})]),_:1}),a(re,{ref_key:"tableRef",ref:S,columns:j.value,data:O.value,loading:o(y),pagination:R,style:Re({height:`${o(t)}px`}),"row-class-name":q,"flex-height":"",remote:"","onUpdate:checkedRowKeys":W},null,8,["columns","data","loading","pagination","style"]),a(qe,{visible:o(x),"onUpdate:visible":c[0]||(c[0]=ce=>Ne(x)?x.value=ce:null),type:n.value,"edit-data":d.value,onRefreshTable:k},null,8,["visible","type","edit-data"])]),_:1})])}}});const pa=Qe(Je,[["__scopeId","data-v-46c54d59"]]);export{pa as default};
