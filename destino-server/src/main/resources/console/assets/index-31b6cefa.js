import{u as H,_ as L}from"./refresh-5c3294a7.js";import{d as V,ap as A,aT as x,r as c,aq as a,as as d,o as B,ak as E,al as O,ar as l,at as s,a4 as z,an as k,au as q,aA as G,bE as I,b4 as M}from"./index-14be5eda.js";import{i as Q}from"./registration-1d625f6b.js";import{u as F,_ as J}from"./use-table-height-bb0e75b4.js";import{_ as K}from"./namespace-tabs.vue_vue_type_script_setup_true_lang-f3c2423e.js";import{N as X}from"./GradientText-e0a89834.js";import{a as N}from"./Select-fe2401fd.js";import{_ as C}from"./Space-6bd69fc7.js";import{_ as Y}from"./Input-3ed2969b.js";import{_ as Z,a as ee}from"./FormItem-7cb46c99.js";import"./Checkbox-e432fb9b.js";import"./Dropdown-be157d33.js";const ae={class:"h-full overflow-hidden"};function te(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!I(m)}const de=V({__name:"index",setup(m){const{t:o}=A(),{loading:g,startLoading:S,endLoading:T}=H(!1),{tableHeight:j,initTableHeight:D}=F(),n=x({namespace:"",groupName:"",serviceName:"",page:0,size:10}),b=c(),_=c(),v=c([]),P=c([{key:"ip",title:()=>o("message.subscriber.address"),minWidth:200,resizable:!0,ellipsis:{tooltip:!0},render:e=>a(X,null,{default:()=>[e.ip,d(":"),e.port]})},{key:"version",title:()=>o("message.subscriber.info"),minWidth:200,resizable:!0,ellipsis:{tooltip:!0},render:e=>{const t=[];return e.platform&&t.push(a(N,{type:"success"},{default:()=>[e.platform]})),e.version&&t.push(a(N,null,{default:()=>[e.version]})),a(C,null,te(t)?t:{default:()=>[t]})}},{key:"types",title:()=>o("message.subscriber.type"),align:"center",resizable:!0,minWidth:150,ellipsis:{tooltip:!0},render:e=>e.types?e.types.join(" / "):""},{key:"subscribeServiceCount",title:()=>o("message.subscriber.serviceCount"),align:"center",resizable:!0,minWidth:50}]),i=x({page:1,pageSize:n.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:e=>{i.page=e,n.page=e-1,p()},onUpdatePageSize:e=>{n.size!==e&&(n.size=e,i.pageSize=e,n.page=0,i.page=1,p())}});B(()=>{D(b),h()});function h(){_.value.load().then(()=>{p()})}async function p(e=!1){S(),e&&(n.page=0,i.page=1);const t=await _.value.selected();n.namespace=t.name;const{data:r}=await Q(n);r?(y(r.records),R(r)):y([]),T()}function y(e){v.value=e}function R(e){i.itemCount=e.total}return(e,t)=>{const r=Y,f=Z,U=ee,W=L,$=J,w=M;return E(),O("div",ae,[a(w,{bordered:!1,class:"rounded-8px shadow-sm"},{default:l(()=>[a(K,{ref_key:"namespaceRef",ref:_,"onUpdate:activated":t[0]||(t[0]=u=>p(!1))},null,512),a(s(C),{class:"pb-12px",justify:"space-between"},{default:l(()=>[a(U,{inline:"","label-placement":"left","show-feedback":!1,size:"small"},{default:l(()=>[a(f,{label:s(o)("message.service.groupName")},{default:l(()=>[a(r,{value:n.groupName,"onUpdate:value":t[1]||(t[1]=u=>n.groupName=u),maxlength:"300",placeholder:""},null,8,["value"])]),_:1},8,["label"]),a(f,{label:s(o)("message.service.name")},{default:l(()=>[a(r,{value:n.serviceName,"onUpdate:value":t[2]||(t[2]=u=>n.serviceName=u),maxlength:"300",placeholder:""},null,8,["value"])]),_:1},8,["label"]),a(f,null,{default:l(()=>[a(s(z),{type:"primary",ghost:"",onClick:t[3]||(t[3]=u=>p(!0))},{default:l(()=>[d(k(s(o)("message.operation.search")),1)]),_:1})]),_:1})]),_:1}),a(s(z),{size:"small",type:"primary",onClick:h},{default:l(()=>[a(W,{class:q(["mr-4px text-16px",{"animate-spin":s(g)}])},null,8,["class"]),d(" "+k(s(o)("message.table.refresh")),1)]),_:1})]),_:1}),a($,{ref_key:"tableRef",ref:b,columns:P.value,data:v.value,loading:s(g),pagination:i,style:G({height:`${s(j)}px`}),"flex-height":"",remote:""},null,8,["columns","data","loading","pagination","style"])]),_:1})])}}});export{de as default};
