import{u as Le,N as Je,_ as Xe}from"./refresh-322ce6d8.js";import{_ as we,a as ea}from"./round-plus-b7c27124.js";import{ba as aa,b9 as ta,bR as sa,bS as na,g as me,b as J,e as ce,P as X,bT as la,bU as oa,d as te,u as ia,bi as ra,k as je,S as ca,t as ua,j as de,n as da,h as ee,G as pa,bV as ma,H as fa,bW as _a,ag as ie,r as w,i as ke,ab as P,ac as ne,ah as e,ai as t,$ as Ae,am as Be,an as K,ao as _e,ad as H,W as De,bX as Se,al as Ve,bq as ae,bY as va,ap as ga,aq as ba,bm as Oe,bt as Ce,aJ as pe,ak as s,aj as D,ae as S,_ as V,as as Ne,bZ as ha,at as be,bx as he,bs as We,bu as ya,o as xa,ar as wa,aW as ka}from"./index-e6583b55.js";import{f as Ca,a as Na,b as $a,c as Ra,d as Ta,e as Ia,g as Pe,h as za}from"./registration-bdac1359.js";import{u as He,_ as Fe}from"./use-table-height-e0ae8eb8.js";import{_ as Ma}from"./namespace-tabs.vue_vue_type_script_setup_true_lang-5bdf7d6b.js";import{c as ye}from"./rule-437f8041.js";import{a as xe}from"./Dropdown-9a22fc8f.js";import{d as Da,_ as Sa,a as Pa,b as ge,c as Ua}from"./Scrollbar-b667961a.js";import{_ as $e}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as Z}from"./Space-83e95913.js";import{_ as Re}from"./Input-d290ecc1.js";import{_ as Ea,a as oe}from"./Select-33cfb7e8.js";import{_ as Te}from"./InputNumber-1e6fbf30.js";import{_ as Ie}from"./Switch-e3f2f06e.js";import{_ as Ge}from"./InputGroup-0b86c50e.js";import{a as ze}from"./Grid-6006f14a.js";import{a as ve,_ as La}from"./FormItem-922e3fb1.js";import{b as ja,a as Aa}from"./Tabs-95f90a19.js";import"./Checkbox-9e61f810.js";import"./Add-8d1daea1.js";import"./throttle-b58cfdb8.js";function Ba(u){return typeof u=="function"?u:aa}function Ue(u,r){var l=ta(u)?sa:na;return l(u,Ba(r))}const Va=me([J("list",`
 --n-merged-border-color: var(--n-border-color);
 --n-merged-color: var(--n-color);
 --n-merged-color-hover: var(--n-color-hover);
 margin: 0;
 font-size: var(--n-font-size);
 transition:
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 padding: 0;
 list-style-type: none;
 color: var(--n-text-color);
 background-color: var(--n-merged-color);
 `,[ce("show-divider",[J("list-item",[me("&:not(:last-child)",[X("divider",`
 background-color: var(--n-merged-border-color);
 `)])])]),ce("clickable",[J("list-item",`
 cursor: pointer;
 `)]),ce("bordered",`
 border: 1px solid var(--n-merged-border-color);
 border-radius: var(--n-border-radius);
 `),ce("hoverable",[J("list-item",`
 border-radius: var(--n-border-radius);
 `,[me("&:hover",`
 background-color: var(--n-merged-color-hover);
 `,[X("divider",`
 background-color: transparent;
 `)])])]),ce("bordered, hoverable",[J("list-item",`
 padding: 12px 20px;
 `),X("header, footer",`
 padding: 12px 20px;
 `)]),X("header, footer",`
 padding: 12px 0;
 box-sizing: border-box;
 transition: border-color .3s var(--n-bezier);
 `,[me("&:not(:last-child)",`
 border-bottom: 1px solid var(--n-merged-border-color);
 `)]),J("list-item",`
 position: relative;
 padding: 12px 0; 
 box-sizing: border-box;
 display: flex;
 flex-wrap: nowrap;
 align-items: center;
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[X("prefix",`
 margin-right: 20px;
 flex: 0;
 `),X("suffix",`
 margin-left: 20px;
 flex: 0;
 `),X("main",`
 flex: 1;
 `),X("divider",`
 height: 1px;
 position: absolute;
 bottom: 0;
 left: 0;
 right: 0;
 background-color: transparent;
 transition: background-color .3s var(--n-bezier);
 pointer-events: none;
 `)])]),la(J("list",`
 --n-merged-color-hover: var(--n-color-hover-modal);
 --n-merged-color: var(--n-color-modal);
 --n-merged-border-color: var(--n-border-color-modal);
 `)),oa(J("list",`
 --n-merged-color-hover: var(--n-color-hover-popover);
 --n-merged-color: var(--n-color-popover);
 --n-merged-border-color: var(--n-border-color-popover);
 `))]),Oa=Object.assign(Object.assign({},je.props),{size:{type:String,default:"medium"},bordered:Boolean,clickable:Boolean,hoverable:Boolean,showDivider:{type:Boolean,default:!0}}),Ze=pa("n-list"),Wa=te({name:"List",props:Oa,setup(u){const{mergedClsPrefixRef:r,inlineThemeDisabled:l,mergedRtlRef:a}=ia(u),k=ra("List",a,r),I=je("List","-list",Va,ma,u,r);ca(Ze,{showDividerRef:ua(u,"showDivider"),mergedClsPrefixRef:r});const $=de(()=>{const{common:{cubicBezierEaseInOut:g},self:{fontSize:z,textColor:p,color:c,colorModal:h,colorPopover:R,borderColor:f,borderColorModal:b,borderColorPopover:y,borderRadius:d,colorHover:N,colorHoverModal:x,colorHoverPopover:_}}=I.value;return{"--n-font-size":z,"--n-bezier":g,"--n-text-color":p,"--n-color":c,"--n-border-radius":d,"--n-border-color":f,"--n-border-color-modal":b,"--n-border-color-popover":y,"--n-color-modal":h,"--n-color-popover":R,"--n-color-hover":N,"--n-color-hover-modal":x,"--n-color-hover-popover":_}}),C=l?da("list",void 0,$,u):void 0;return{mergedClsPrefix:r,rtlEnabled:k,cssVars:l?void 0:$,themeClass:C==null?void 0:C.themeClass,onRender:C==null?void 0:C.onRender}},render(){var u;const{$slots:r,mergedClsPrefix:l,onRender:a}=this;return a==null||a(),ee("ul",{class:[`${l}-list`,this.rtlEnabled&&`${l}-list--rtl`,this.bordered&&`${l}-list--bordered`,this.showDivider&&`${l}-list--show-divider`,this.hoverable&&`${l}-list--hoverable`,this.clickable&&`${l}-list--clickable`,this.themeClass],style:this.cssVars},r.header?ee("div",{class:`${l}-list__header`},r.header()):null,(u=r.default)===null||u===void 0?void 0:u.call(r),r.footer?ee("div",{class:`${l}-list__footer`},r.footer()):null)}}),Ha=te({name:"ListItem",setup(){const u=fa(Ze,null);return u||_a("list-item","`n-list-item` must be placed in `n-list`."),{showDivider:u.showDividerRef,mergedClsPrefix:u.mergedClsPrefixRef}},render(){const{$slots:u,mergedClsPrefix:r}=this;return ee("li",{class:`${r}-list-item`},u.prefix?ee("div",{class:`${r}-list-item__prefix`},u.prefix()):null,u.default?ee("div",{class:`${r}-list-item__main`},u):null,u.suffix?ee("div",{class:`${r}-list-item__suffix`},u.suffix()):null,this.showDivider&&ee("div",{class:`${r}-list-item__divider`}))}});const Ke=u=>(ga("data-v-7ec5b708"),u=u(),ba(),u),Fa={class:"input_row"},Ga={class:"key"},Za=["onUpdate:modelValue","readonly"],Ka={class:"value"},qa=["onUpdate:modelValue","readonly"],Ya={key:0,class:"flex"},Qa=Ke(()=>H("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[H("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),Ja=Ke(()=>H("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[H("line",{x1:"400",y1:"256",x2:"112",y2:"256",style:{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32px"}})],-1)),Xa=te({name:"MetadataEditor",__name:"metadata",props:{theme:{default:"dark"},data:{default:null},readonly:{type:Boolean,default:!1}},setup(u,{expose:r}){const l=u,{t:a}=ie(),k=w(C());function I(p){k.value.splice(p+1,0,{key:"",value:""})}function $(p){k.value.length===1?k.value=C():k.value.splice(p,1)}function C(){return[{key:"",value:""}]}function g(){const p={},c=new Set;for(const h of k.value)ae(h.key)||(va(p,h.key)&&c.add(h.key),p[h.key]=h.value);if(!ae(c))throw new Error(a("message.service.duplicateKeyInMetadata")+Array.from(c).join(", "));return p}ke(()=>l.data,p=>{if(p){const c=[];Ue(p,(h,R)=>{c.push({key:R,value:h})}),ae(c)&&c.push({key:"",value:""}),k.value=c;return}k.value=[{key:"",value:""}]},{immediate:!0});function z(p){if(p){const c=[];Ue(p,(h,R)=>{c.push({key:R,value:h})}),ae(c)&&c.push({key:"",value:""}),k.value=c;return}k.value=[{key:"",value:""}]}return r({setData:z,getData:g}),(p,c)=>{const h=xe,R=Ha,f=Wa,b=Da;return P(),ne("div",{class:Ve(`theme-${p.theme} w-100`)},[e(b,{style:{"max-height":"120px"},size:1,class:"pe_scrollbar"},{default:t(()=>[e(f,{class:"pe_panel","show-divider":!1,clickable:""},{default:t(()=>[(P(!0),ne(Ae,null,Be(k.value,(y,d)=>(P(),K(R,{key:d,style:{padding:"0"}},{suffix:t(()=>[p.readonly?_e("",!0):(P(),ne("div",Ya,[e(h,{color:"#0e7a0d",onClick:N=>I(d)},{default:t(()=>[Qa]),_:2},1032,["onClick"]),e(h,{onClick:N=>$(d)},{default:t(()=>[Ja]),_:2},1032,["onClick"])]))]),default:t(()=>[H("div",Fa,[H("div",Ga,[De(H("input",{"onUpdate:modelValue":N=>y.key=N,class:"pe_input",type:"text",readonly:p.readonly},null,8,Za),[[Se,y.key]])]),H("div",Ka,[De(H("input",{"onUpdate:modelValue":N=>y.value=N,class:"pe_input",type:"text",readonly:p.readonly},null,8,qa),[[Se,y.value]])])])]),_:2},1024))),128))]),_:1})]),_:1})],2)}}});const Me=$e(Xa,[["__scopeId","data-v-7ec5b708"]]),et=te({name:"ServiceActionModal",__name:"action-modal",props:{visible:{type:Boolean},type:{default:"add"},editData:{default:null}},emits:["update:visible","refresh-table"],setup(u,{emit:r}){const l=u,{t:a}=ie(),{clear:k}=Oe(),{hasPermission:I}=Ce(),$=w(!1),C=w(),g=w([]),z={serviceName:ye(()=>a("message.service.name")),groupName:ye(()=>a("message.service.groupName"))},p=w(),c=pe(y()),h=de({get(){return l.visible},set(x){r("update:visible",x)}}),R=de(()=>({add:a("message.service.addTitle"),edit:a("message.service.updateTitle")})[l.type]);function f(){h.value=!1}function b(x){x&&c.expiredMillis<0&&(c.expiredMillis=5e3)}function y(){return{namespace:"",serviceName:"",expectantInstanceCount:3,enabled:!0,healthCheck:!0,cleanable:!1,expiredMillis:0,metadata:{}}}async function d(){if(Object.assign(c,y()),l.editData?($.value=I("WRITE",["REGISTRATION",l.editData.namespace]),Object.assign(c,l.editData)):$.value=!1,l.type==="add"){const{data:x}=await ha(c.namespace,"WRITE");x?g.value=x.map(_=>({label:_,value:_})):g.value=[]}}async function N(){var x,_,E,T;await((x=p.value)==null?void 0:x.validate());try{c.metadata=C.value.getData()}catch(M){(_=window.$message)==null||_.warning(M.message);return}if(l.type==="add"){const{error:M}=await Ca(c);M||((E=window.$message)==null||E.success(a("message.operation.addSuccess")),k(),r("refresh-table"),f())}else if(l.editData){const{expectantInstanceCount:M,enabled:U,cleanable:F,expiredMillis:q,metadata:se,healthCheck:j}=c,{error:i}=await Na(l.editData,{expectantInstanceCount:M,enabled:U,cleanable:F,expiredMillis:q,metadata:se,healthCheck:j});i||((T=window.$message)==null||T.success(a("message.operation.updateSuccess")),k(),r("refresh-table"),f())}}return ke(()=>l.visible,x=>{x&&d()}),(x,_)=>{const E=Re,T=we,M=Ea,U=Te,F=Ie,q=oe,se=Ge,j=ze,i=ve,n=Ne;return P(),K(n,{show:h.value,"onUpdate:show":_[7]||(_[7]=m=>h.value=m),preset:"card",title:R.value,class:"w-500px"},{default:t(()=>[e(i,{ref_key:"formRef",ref:p,"label-placement":"left",size:"small","label-align":"left","label-width":"auto",model:c,rules:z},{default:t(()=>[e(j,{cols:12,"x-gap":18},{default:t(()=>[e(T,{span:12,label:s(a)("message.service.name"),path:"serviceName"},{default:t(()=>[e(E,{value:c.serviceName,"onUpdate:value":_[0]||(_[0]=m=>c.serviceName=m),disabled:l.type==="edit",maxlength:"300",placeholder:s(a)("message.service.namePlaceholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),e(T,{span:12,label:s(a)("message.service.groupName"),path:$.value?"":"groupName"},{default:t(()=>[e(M,{value:c.groupName,"onUpdate:value":_[1]||(_[1]=m=>c.groupName=m),placeholder:s(a)("message.service.groupNamePlaceholder"),disabled:l.type==="edit",filterable:"",tag:$.value,options:g.value},null,8,["value","placeholder","disabled","tag","options"])]),_:1},8,["label","path"]),e(T,{span:12,label:s(a)("message.service.expectant")},{default:t(()=>[e(U,{value:c.expectantInstanceCount,"onUpdate:value":_[2]||(_[2]=m=>c.expectantInstanceCount=m),min:0,max:1e6,"update-value-on-input":!1},null,8,["value"])]),_:1},8,["label"]),e(T,{span:12,label:s(a)("message.service.metadata")},{default:t(()=>[e(Me,{ref_key:"metadataRef",ref:C,data:c.metadata},null,8,["data"])]),_:1},8,["label"]),e(T,{span:12,label:s(a)("message.service.cleanable")},{default:t(()=>[e(s(Z),{align:"center",justify:"space-between",size:"small",inline:"",wrap:!1},{default:t(()=>[e(F,{value:c.cleanable,"onUpdate:value":[_[3]||(_[3]=m=>c.cleanable=m),b]},null,8,["value"]),c.cleanable?(P(),K(se,{key:0},{default:t(()=>[e(q,{type:"success",round:""},{default:t(()=>[D(S(s(a)("message.service.cleanInterval")),1)]),_:1}),e(U,{value:c.expiredMillis,"onUpdate:value":_[4]||(_[4]=m=>c.expiredMillis=m),round:"",min:0,max:9999999999,size:"small","show-button":!1,"update-value-on-input":!1},{suffix:t(()=>[D(S(s(a)("message.system.millis")),1)]),_:1},8,["value"])]),_:1})):_e("",!0)]),_:1})]),_:1},8,["label"]),e(T,{span:12,label:s(a)("message.service.healthCheck")},{default:t(()=>[e(F,{value:c.healthCheck,"onUpdate:value":_[5]||(_[5]=m=>c.healthCheck=m)},null,8,["value"])]),_:1},8,["label"]),e(T,{span:12,label:s(a)("message.service.enabled")},{default:t(()=>[e(F,{value:c.enabled,"onUpdate:value":_[6]||(_[6]=m=>c.enabled=m)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(s(Z),{class:"w-full pt-16px",size:24,justify:"end"},{default:t(()=>[e(s(V),{onClick:f},{default:t(()=>[D(S(s(a)("message.operation.cancel")),1)]),_:1}),e(s(V),{type:"primary","attr-type":"submit",onClick:N},{default:t(()=>[D(S(s(a)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),at=te({name:"ServiceDetailModal",__name:"detail-modal",props:{visible:{type:Boolean},data:{}},emits:["update:visible","refresh-table"],setup(u,{emit:r}){const l=u,{t:a}=ie(),k=w(),I=w(),$=de({get(){return l.visible},set(g){r("update:visible",g)}});function C(){$.value=!1}return(g,z)=>{const p=we,c=Ie,h=oe,R=Te,f=Ge,b=ze,y=ve,d=Ne;return P(),K(d,{show:$.value,"onUpdate:show":z[0]||(z[0]=N=>$.value=N),preset:"card",title:s(a)("message.service.detailTitle"),class:"w-500px"},{default:t(()=>[e(y,{ref_key:"formRef",ref:I,"label-placement":"left",size:"small","label-align":"left","label-width":"auto","show-feedback":!1},{default:t(()=>[e(b,{cols:12,"x-gap":18,"y-gap":16},{default:t(()=>[e(p,{span:12,label:s(a)("message.service.name")},{default:t(()=>[D(S(l.data.serviceName),1)]),_:1},8,["label"]),e(p,{span:12,label:s(a)("message.service.groupName")},{default:t(()=>[D(S(l.data.groupName),1)]),_:1},8,["label"]),e(p,{span:12,label:s(a)("message.service.expectant")},{default:t(()=>[D(S(l.data.expectantInstanceCount),1)]),_:1},8,["label"]),e(p,{span:12,label:s(a)("message.service.metadata")},{default:t(()=>[e(Me,{ref_key:"metadataRef",ref:k,data:l.data.metadata,readonly:!0},null,8,["data"])]),_:1},8,["label"]),e(p,{span:12,label:s(a)("message.service.cleanable")},{default:t(()=>[e(s(Z),{align:"center",justify:"space-between",size:"small",inline:"",wrap:!1},{default:t(()=>[e(c,{value:l.data.expiredMillis>=0},null,8,["value"]),l.data.expiredMillis>=0?(P(),K(f,{key:0},{default:t(()=>[e(h,{type:"success",round:""},{default:t(()=>[D(S(s(a)("message.service.cleanInterval")),1)]),_:1}),e(R,{value:l.data.expiredMillis,readonly:!0,round:"",min:0,max:9999999999,size:"small","show-button":!1,"update-value-on-input":!1},{suffix:t(()=>[D(S(s(a)("message.system.millis")),1)]),_:1},8,["value"])]),_:1})):_e("",!0)]),_:1})]),_:1},8,["label"]),e(p,{span:12,label:s(a)("message.service.healthCheck")},{default:t(()=>[e(c,{value:l.data.healthCheck},null,8,["value"])]),_:1},8,["label"]),e(p,{span:12,label:s(a)("message.service.enabled")},{default:t(()=>[e(c,{value:l.data.enabled},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(s(Z),{class:"w-full pt-16px",size:24,justify:"end"},{default:t(()=>[e(s(V),{onClick:C},{default:t(()=>[D(S(s(a)("message.operation.back")),1)]),_:1})]),_:1})]),_:1},512)]),_:1},8,["show","title"])}}}),tt={class:"inline-block",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48"},st=H("path",{fill:"currentColor",d:"M43.634 4.366a1.25 1.25 0 0 1 0 1.768l-4.913 4.913a9.253 9.253 0 0 1-.744 12.244l-3.343 3.343a1.25 1.25 0 0 1-1.768 0l-11.5-11.5a1.25 1.25 0 0 1 0-1.768l3.343-3.343a9.251 9.251 0 0 1 12.244-.743l4.913-4.914a1.25 1.25 0 0 1 1.768 0ZM9.28 36.953l-4.914 4.913a1.25 1.25 0 0 0 1.768 1.768l4.913-4.913a9.253 9.253 0 0 0 12.244-.744l3.343-3.343a1.25 1.25 0 0 0 0-1.768L25.268 31.5l3.366-3.366a1.25 1.25 0 0 0-1.768-1.768L23.5 29.732L18.268 24.5l3.366-3.366a1.25 1.25 0 0 0-1.768-1.768L16.5 22.732l-1.366-1.366a1.25 1.25 0 0 0-1.768 0l-3.343 3.343a9.251 9.251 0 0 0-.743 12.244Z"},null,-1),nt=[st];function lt(u,r){return P(),ne("svg",tt,nt)}const ot={name:"local-disconnected",render:lt},it={class:"inline-block",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},rt=H("path",{fill:"currentColor",d:"M17.78 3.28a.75.75 0 0 0-1.06-1.06l-2.446 2.445a4.037 4.037 0 0 0-5.128.481l-.3.3a1.49 1.49 0 0 0 0 2.108l2.465 2.464a5.51 5.51 0 0 1 4.552-.848a4.041 4.041 0 0 0-.528-3.444L17.78 3.28ZM7.554 8.846l2.464 2.465a5.51 5.51 0 0 0-.848 4.552a4.041 4.041 0 0 1-3.444-.528L3.28 17.78a.75.75 0 0 1-1.06-1.06l2.446-2.446a4.037 4.037 0 0 1 .48-5.128l.3-.3a1.49 1.49 0 0 1 2.108 0ZM19 14.5a4.5 4.5 0 1 1-9 0a4.5 4.5 0 0 1 9 0Zm-2.146-1.854a.5.5 0 0 0-.708 0L13.5 15.293l-.646-.647a.5.5 0 0 0-.708.708l1 1a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0 0-.708Z"},null,-1),ct=[rt];function ut(u,r){return P(),ne("svg",it,ct)}const dt={name:"local-connected",render:ut},pt=te({name:"InstanceEditModal",__name:"instance-edit",props:{visible:{type:Boolean},value:{}},emits:["update:visible","update-row"],setup(u,{emit:r}){const l=u,{t:a}=ie(),{clear:k}=Oe(),I={serviceName:ye(()=>a("message.service.name"))},$=w(),C=w(),g=pe(c()),z=de({get(){return l.visible},set(f){r("update:visible",f)}});function p(){z.value=!1}function c(){return{ip:"",port:0,mode:"QUICKLY",weight:1,healthy:!0,enabled:!0,udpPort:0,schedules:[],cluster:"",metadata:{}}}async function h(){Object.assign(g,c()),l.value&&Object.assign(g,l.value.instance)}async function R(){var y,d,N;await((y=C.value)==null?void 0:y.validate());try{g.metadata=$.value.getData()}catch(x){(d=window.$message)==null||d.warning(x.message);return}if(!l.value)return;const{error:f,data:b}=await $a({namespace:l.value.namespace,groupName:l.value.groupName,serviceName:l.value.serviceName,cluster:l.value.instance.cluster,ip:l.value.instance.ip,port:l.value.instance.port,weight:g.weight,enabled:g.enabled,metadata:g.metadata});f||((N=window.$message)==null||N.success(a("message.operation.updateSuccess")),k(),b&&r("update-row",b),p())}return ke(()=>l.visible,f=>{f&&h()}),(f,b)=>{const y=Re,d=we,N=Te,x=Ie,_=ze,E=ve,T=Ne;return P(),K(T,{show:z.value,"onUpdate:show":b[2]||(b[2]=M=>z.value=M),preset:"card",title:s(a)("message.instance.updateTitle"),class:"w-500px"},{default:t(()=>[e(E,{ref_key:"formRef",ref:C,"label-placement":"left",size:"small","label-align":"left","label-width":"auto",model:g,rules:I},{default:t(()=>[e(_,{cols:12,"x-gap":18},{default:t(()=>[e(d,{span:12,label:s(a)("message.instance.ip")},{default:t(()=>[e(y,{value:g.ip,disabled:!0},null,8,["value"])]),_:1},8,["label"]),e(d,{span:12,label:s(a)("message.instance.port")},{default:t(()=>[e(N,{value:g.port,disabled:!0,"show-button":!1},null,8,["value"])]),_:1},8,["label"]),e(d,{span:12,label:s(a)("message.instance.weight")},{default:t(()=>[e(N,{value:g.weight,"onUpdate:value":b[0]||(b[0]=M=>g.weight=M),min:0,max:1e6,precision:2,"update-value-on-input":!1,step:"0.5"},null,8,["value"])]),_:1},8,["label"]),e(d,{span:12,label:s(a)("message.instance.metadata")},{default:t(()=>[e(Me,{ref_key:"metadataRef",ref:$,data:g.metadata},null,8,["data"])]),_:1},8,["label"]),e(d,{span:12,label:s(a)("message.instance.enabled")},{default:t(()=>[e(x,{value:g.enabled,"onUpdate:value":b[1]||(b[1]=M=>g.enabled=M)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(s(Z),{class:"w-full pt-16px",size:24,justify:"end"},{default:t(()=>[e(s(V),{onClick:p},{default:t(()=>[D(S(s(a)("message.operation.cancel")),1)]),_:1}),e(s(V),{type:"primary","attr-type":"submit",onClick:R},{default:t(()=>[D(S(s(a)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});function fe(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!We(u)}const Ee=50,mt=te({name:"InstanceList",__name:"instances",setup(u,{expose:r}){let l=!1;const{t:a}=ie(),{hasPermission:k}=Ce(),{bool:I,setTrue:$}=be(),{tableHeight:C,initTableHeight:g}=He(!1),{loading:z,startLoading:p,endLoading:c}=Le(!1),h=w(!1),R=w(),f=w(),b=w(""),y=w(),d=pe({namespace:"",groupName:"",serviceName:"",clusters:[],data:new Map}),N=w([{key:"ip",title:()=>a("message.instance.ip"),titleAlign:"center",minWidth:120,ellipsis:{tooltip:!0}},{key:"port",align:"center",titleAlign:"center",title:()=>a("message.instance.port"),minWidth:60},{key:"mode",title:()=>a("message.instance.registerMode"),align:"center",minWidth:60,render:i=>{if(i.mode==="SAFETY"){let n;return e(oe,{round:!0,type:"success",size:"small"},fe(n=a("message.instance.safety"))?n:{default:()=>[n]})}if(i.mode==="QUICKLY"){let n;return e(oe,{round:!0,type:"success",size:"small"},fe(n=a("message.instance.quickly"))?n:{default:()=>[n]})}return e(oe,{round:!0},{default:()=>[i.mode]})}},{key:"weight",title:()=>a("message.instance.weight"),align:"center",minWidth:60},{key:"healthy",title:()=>a("message.instance.healthy"),align:"center",minWidth:60,render:i=>i.healthy?e(xe,{color:"#18a058",size:"18"},{default:()=>[e(dt,{class:"text-18px"},null)]}):e(xe,{color:"#d03050"},{default:()=>[e(ot,{class:"text-18px"},null)]})},{key:"metadata",title:()=>a("message.instance.metadata"),align:"center",ellipsis:!0,render:i=>{if(!i.metadata)return"";const n=Object.keys(i.metadata);return ae(n)?"":e(Je,{trigger:"hover",delay:1e3},{trigger:()=>e("p",null,[`${n[0]}: ${i.metadata[n[0]]}`]),default:()=>n.map(m=>e("p",null,[`${m}: ${i.metadata[m]}`]))})}}]),x=k("WRITE",["REGISTRATION",d.namespace,d.groupName,d.serviceName]);x&&N.value.push({key:"actions",title:()=>a("message.table.operation"),align:"center",minWidth:80,render:i=>{const n=[];if(x){let m;n.push(e(V,{size:"small",onClick:()=>F(i)},fe(m=a("message.operation.update"))?m:{default:()=>[m]}))}return e(Z,{justify:"center"},fe(n)?n:{default:()=>[n]})}});async function _({namespace:i,serviceName:n,groupName:m}){const L={namespace:i,serviceName:n,groupName:m};(i!==d.namespace||m!==d.groupName||n!==d.serviceName)&&(b.value="",Object.assign(d,L)),await E(L),h.value=!0,l||(l=!0,g(R))}async function E(i){d.clusters=[],d.data.clear();const{data:n}=await Ra(i);n&&(ae(n.records)||(d.clusters.push(...n.records),T(n.records[0].name)))}async function T(i){b.value=i,setTimeout(()=>{f.value&&f.value.syncBarPosition()},50);let n=d.data.get(i);return n||(n={end:!1,tableData:[]},d.data.set(i,n)),!n.end&&ae(n.tableData)&&await M(i),!0}async function M(i){await U(i)}async function U(i){p();let n=d.data.get(i);n||(n={end:!1,tableData:[]},d.data.set(i,n));const{namespace:m,serviceName:L,groupName:re}=d,{data:G}=await Ta({namespace:m,serviceName:L,groupName:re,cluster:i,limit:Ee,pos:n.pos});if(G){if(n.tableData.push(...G),ae(G))n.end=!0;else{const le=G.length,W=G[le-1];n.pos=`${W.ip}:${W.port}`,le<Ee&&(n.end=!0)}d.data.set(i,n)}c()}function F(i){const{namespace:n,serviceName:m,groupName:L}=d;y.value={namespace:n,serviceName:m,groupName:L,instance:i},$()}function q(i){if(y.value){const{ip:n,port:m,cluster:L}=y.value.instance;if(n===i.ip&&m===i.port&&L===i.cluster){y.value.instance.weight=i.weight,y.value.instance.enabled=i.enabled,y.value.instance.metadata=i.metadata;return}}if(i){const n=d.data.get(i.cluster);n&&(n.end=!1,n.tableData=[],U(b.value))}}function se(i){if(i.target){const n=i.target.clientHeight,m=i.target.scrollTop,L=i.target.scrollHeight;m+n>=L-30&&U(b.value)}}function j(i){return i.enabled?"":"instance-disabled"}return r({open:_}),(i,n)=>{const m=ja,L=Aa,re=Fe,G=Sa,le=Pa;return P(),K(le,{show:h.value,"onUpdate:show":n[2]||(n[2]=W=>h.value=W),"display-directive":"show",width:1e3,placement:"right",resizable:"","close-on-esc":""},{default:t(()=>[e(G,{title:s(a)("message.instance.title"),"native-scrollbar":!1,closable:""},{default:t(()=>{var W;return[e(L,{ref_key:"clusterTabsRef",ref:f,value:b.value,"onUpdate:value":n[0]||(n[0]=o=>b.value=o),type:"bar",class:"pb-3","default-value":"DEFAULT",onBeforeLeave:T},{prefix:t(()=>[e(s(oe),{type:"success",round:"",bordered:!1},{default:t(()=>[D(S(s(a)("message.service.cluster")),1)]),_:1})]),default:t(()=>[(P(!0),ne(Ae,null,Be(d.clusters,(o,v)=>(P(),K(m,{key:v,name:o.name},null,8,["name"]))),128))]),_:1},8,["value"]),e(re,{ref_key:"instanceListRef",ref:R,size:"small",columns:N.value,data:(W=d.data.get(b.value))==null?void 0:W.tableData,loading:s(z),"row-class-name":j,"min-height":s(C),"flex-height":"",remote:"",onScroll:se},null,8,["columns","data","loading","min-height"])]}),_:1},8,["title"]),e(pt,{visible:s(I),"onUpdate:visible":n[1]||(n[1]=W=>he(I)?I.value=W:null),value:y.value,onUpdateRow:q},null,8,["visible","value"])]),_:1},8,["show"])}}});const ft=$e(mt,[["__scopeId","data-v-ac49ebf8"]]),_t={class:"h-full overflow-hidden"};function ue(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!We(u)}const vt=te({__name:"index",setup(u){const{t:r}=ie(),{warning:l}=ya(),{hasPermission:a,hasDeepPermission:k}=Ce(),{bool:I,setTrue:$}=be(),{bool:C,setTrue:g}=be(),{loading:z,startLoading:p,endLoading:c}=Le(!1),{tableHeight:h,initTableHeight:R}=He(),f=pe({namespace:"",groupName:null,serviceName:null,page:0,size:10}),b=w("add"),y=w(null),d=w({namespace:"",serviceName:"",groupName:"",expectantInstanceCount:3,enabled:!0,healthCheck:!0,expiredMillis:5e3,metadata:{}}),N=w(!1),x=w(),_=w(),E=w(),T=w([]),M=w([{key:"serviceName",title:()=>r("message.service.name"),width:200,resizable:!0,ellipsis:{tooltip:!0}},{key:"groupName",title:()=>r("message.service.groupName"),width:200,resizable:!0,ellipsis:{tooltip:!0}},{key:"clusterCount",title:()=>r("message.service.clusterCount"),align:"center",resizable:!0,width:150,ellipsis:{tooltip:!0}},{key:"instanceCount",title:()=>r("message.service.instanceView"),align:"center",resizable:!0,minWidth:300,ellipsis:{tooltip:!0},render:o=>{let v;return o.healthyInstanceCount>=o.expectantInstanceCount||o.healthyInstanceCount>=o.instanceCount?v="c-green":v="c-red",e(Ua,null,{default:()=>[e(ge,{clickable:!1},{default:()=>[o.instanceCount]}),e(ge,{clickable:!1},{default:()=>[e("span",{class:v},[o.healthyInstanceCount])]}),e(ge,{clickable:!1},{default:()=>[e("span",{class:"c-orange"},[o.expectantInstanceCount])]})]})}},{key:"actions",title:()=>r("message.table.operation"),align:"center",width:270,render:o=>{let v;const A=a("WRITE",["REGISTRATION",o.namespace,o.groupName,o.serviceName]),Y=a("DELETE",["REGISTRATION",o.namespace,o.groupName,o.serviceName]),O=[];if(O.push(e(V,{size:"small",onClick:()=>re(o)},ue(v=r("message.service.instances"))?v:{default:()=>[v]})),A){let B;O.push(e(V,{size:"small",onClick:()=>le(o)},ue(B=r("message.operation.update"))?B:{default:()=>[B]}))}else{let B;O.push(e(V,{size:"small",onClick:()=>G(o)},ue(B=r("message.operation.detail"))?B:{default:()=>[B]}))}if(Y){let B;O.push(e(V,{size:"small",onClick:()=>W(o)},ue(B=r("message.operation.delete"))?B:{default:()=>[B]}))}return e(Z,{justify:"center"},ue(O)?O:{default:()=>[O]})}}]),U=pe({page:1,pageSize:f.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:o=>{U.page=o,f.page=o-1,j()},onUpdatePageSize:o=>{f.size!==o&&(f.size=o,U.pageSize=o,f.page=0,U.page=1,j())}});xa(()=>{R(x),F()});function F(){E.value.load().then(()=>{q(),j()})}async function q(){const o=await E.value.selected();N.value=k("WRITE",["REGISTRATION",o.name])}async function se(){q(),j(!0)}async function j(o=!1){p(),o&&(f.page=0,U.page=1);const v=await E.value.selected();f.namespace=v.name;const{data:A}=await Ia(f);A?(i(A.records),n(A)):i([]),c()}function i(o){T.value=o}function n(o){U.itemCount=o.total}function m(o){return o.enabled?"":"service-disabled"}async function L(){b.value="add";const o=await E.value.selected();y.value={namespace:o.name,serviceName:"",groupName:void 0,expectantInstanceCount:3,enabled:!0,healthCheck:!0,cleanable:!1,expiredMillis:0,metadata:{}},$()}function re(o){_.value.open(o)}async function G(o){const{data:v}=await Pe({namespace:o.namespace,serviceName:o.serviceName,groupName:o.groupName});v&&(d.value=v,g())}async function le(o){b.value="edit";const{data:v}=await Pe({namespace:o.namespace,serviceName:o.serviceName,groupName:o.groupName});if(v){const A=v.expiredMillis>=0;y.value={...v,cleanable:A},$()}}async function W(o){l({title:r("message.tip._value"),content:r("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:r("message.operation.confirm"),negativeText:r("message.operation.cancel"),onPositiveClick:async()=>{var Y,O;const{error:v,data:A}=await za({namespace:o.namespace,groupName:o.groupName,serviceName:o.serviceName});v||(A?(Y=window.$message)==null||Y.success(A):(O=window.$message)==null||O.success(r("message.operation.deleteSuccess")),j())}})}return(o,v)=>{const A=Re,Y=La,O=ve,B=ea,qe=Xe,Ye=Fe,Qe=ka;return P(),ne("div",_t,[e(Qe,{bordered:!1,class:"rounded-8px shadow-sm"},{default:t(()=>[e(Ma,{ref_key:"namespaceRef",ref:E,"onUpdate:activated":se},null,512),e(s(Z),{class:"pb-12px",justify:"space-between"},{default:t(()=>[e(O,{inline:"","label-placement":"left","label-align":"left",size:"small","show-feedback":!1},{default:t(()=>[e(Y,{label:s(r)("message.service.groupName")},{default:t(()=>[e(A,{value:f.groupName,"onUpdate:value":v[0]||(v[0]=Q=>f.groupName=Q),maxlength:"300"},null,8,["value"])]),_:1},8,["label"]),e(Y,{label:s(r)("message.service.name")},{default:t(()=>[e(A,{value:f.serviceName,"onUpdate:value":v[1]||(v[1]=Q=>f.serviceName=Q),maxlength:"300"},null,8,["value"])]),_:1},8,["label"]),e(Y,null,{default:t(()=>[e(s(V),{type:"primary",ghost:"",onClick:v[2]||(v[2]=Q=>j(!0))},{default:t(()=>[D(S(s(r)("message.operation.search")),1)]),_:1})]),_:1})]),_:1}),e(s(Z),null,{default:t(()=>[N.value?(P(),K(s(V),{key:0,size:"small",type:"primary",onClick:L},{default:t(()=>[e(B,{class:"mr-4px text-20px"}),D(" "+S(s(r)("message.service.create")),1)]),_:1})):_e("",!0),e(s(V),{size:"small",type:"primary",onClick:F},{default:t(()=>[e(qe,{class:Ve(["mr-4px text-16px",{"animate-spin":s(z)}])},null,8,["class"]),D(" "+S(s(r)("message.table.refresh")),1)]),_:1})]),_:1})]),_:1}),e(Ye,{ref_key:"tableRef",ref:x,columns:M.value,data:T.value,loading:s(z),pagination:U,style:wa({height:`${s(h)}px`}),"row-class-name":m,"flex-height":"",remote:""},null,8,["columns","data","loading","pagination","style"]),e(et,{visible:s(I),"onUpdate:visible":v[3]||(v[3]=Q=>he(I)?I.value=Q:null),type:b.value,"edit-data":y.value,onRefreshTable:j},null,8,["visible","type","edit-data"]),e(at,{visible:s(C),"onUpdate:visible":v[4]||(v[4]=Q=>he(C)?C.value=Q:null),data:d.value},null,8,["visible","data"]),e(ft,{ref_key:"instanceListRef",ref:_},null,512)]),_:1})])}}});const At=$e(vt,[["__scopeId","data-v-43ea1bf4"]]);export{At as default};
