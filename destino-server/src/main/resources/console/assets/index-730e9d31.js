import{u as R,_ as V}from"./refresh-8cb36cef.js";import{bH as z,d as $,ag as G,bu as q,bt as A,aJ as y,r as p,ah as a,aj as m,o as J,ab as M,ac as Q,ai as c,ak as r,_ as d,ae as x,al as Y,ar as F,aW as K,bs as X}from"./index-10b862f4.js";import{u as Z,_ as ee}from"./use-table-height-1a043db3.js";import{_ as te}from"./InputGroup-b9f9b91a.js";import{N as v}from"./GradientText-69fd17e2.js";import{a as k}from"./Select-ddad6208.js";import{_ as se}from"./Input-facf482e.js";import{_ as ae}from"./Space-73163714.js";import"./Checkbox-4dc29fdd.js";import"./Dropdown-4d48d12f.js";function ne(n){return z.get("/cluster/members",{params:n})}function oe(n){return z.delete(`/cluster/deregister/${n}`)}const re={class:"h-full overflow-hidden"};function ie(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!X(n)}const ye=$({__name:"index",setup(n){const{t}=G(),{warning:T}=q(),{hasPermission:P}=A(),{loading:_,startLoading:w,endLoading:S}=R(!1),{tableHeight:C,initTableHeight:D}=Z(),o=y({address:"",page:0,size:10}),g=p(),f=p([]),h=[];P("DELETE","SETTING")&&h.push({key:"actions",title:()=>t("message.table.operation"),align:"center",width:200,render:e=>{let s;return a(d,{size:"small",onClick:()=>E(e.id)},ie(s=t("message.cluster.offline"))?s:{default:()=>[s]})}});const N=p([{key:"id",title:()=>t("message.cluster.id"),width:70},{key:"ip",title:()=>t("message.cluster.server"),align:"center",maxWidth:100,resizable:!0,ellipsis:{tooltip:!0},render:e=>a(v,null,{default:()=>[e.ip,m(":"),e.port]})},{key:"outerPort",title:()=>t("message.cluster.outerPort"),align:"center",resizable:!0,maxWidth:70,ellipsis:{tooltip:!0},render:e=>a(v,null,{default:()=>[e.outerPort]})},{key:"state",title:()=>t("message.cluster.state"),align:"center",resizable:!0,maxWidth:120,render:e=>a(k,{type:L(e.state)},{default:()=>[e.state]})},{key:"extendInfo",title:()=>t("message.cluster.version"),align:"center",resizable:!0,maxWidth:120,ellipsis:{tooltip:!0},render:e=>a(k,null,{default:()=>{var s;return[(s=e.extendInfo)==null?void 0:s.version]}})},...h]),l=y({page:1,pageSize:o.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:e=>{l.page=e,o.page=e-1,i()},onUpdatePageSize:e=>{o.size!==e&&(l.page=1,l.pageSize=e,o.page=0,o.size=e,i())}});J(()=>{D(g),i()});async function i(){w();const{data:e}=await ne(o);e?(b(e.records),H(e)):b([]),S()}function b(e){f.value=e.map(s=>({...s,key:s.id}))}async function E(e){T({title:t("message.tip._value"),content:t("message.cluster.confirmOffline"),positiveButtonProps:{type:"primary"},positiveText:t("message.operation.confirm"),negativeText:t("message.operation.cancel"),onPositiveClick:async()=>{var u;const{error:s}=await oe(e);s||((u=window.$message)==null||u.success(t("message.cluster.offlineSuccess")),i())}})}function H(e){l.itemCount=e.total}function L(e){switch(e){case"UP":return"success";case"UNHEALTHY":return"warning";case"DOWN":return"error";default:return"default"}}return(e,s)=>{const u=se,W=te,j=V,I=ae,O=ee,U=K;return M(),Q("div",re,[a(U,{bordered:!1,class:"rounded-8px shadow-sm"},{default:c(()=>[a(I,{class:"pb-12px",justify:"space-between"},{default:c(()=>[a(W,{style:{width:"120%"}},{default:c(()=>[a(u,{value:o.address,"onUpdate:value":s[0]||(s[0]=B=>o.address=B),maxlength:"50",placeholder:r(t)("message.cluster.serverPlaceholder")},null,8,["value","placeholder"]),a(r(d),{type:"primary",ghost:"",onClick:i},{default:c(()=>[m(x(r(t)("message.operation.search")),1)]),_:1})]),_:1}),a(r(d),{size:"small",type:"primary",onClick:i},{default:c(()=>[a(j,{class:Y(["mr-4px text-16px",{"animate-spin":r(_)}])},null,8,["class"]),m(" "+x(r(t)("message.table.refresh")),1)]),_:1})]),_:1}),a(O,{ref_key:"tableRef",ref:g,columns:N.value,data:f.value,loading:r(_),pagination:l,style:F({height:`${r(C)}px`}),"flex-height":"",remote:""},null,8,["columns","data","loading","pagination","style"])]),_:1})])}}});export{ye as default};
