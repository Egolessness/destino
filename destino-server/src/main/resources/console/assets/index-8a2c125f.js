import{u as G,_ as R}from"./refresh-5c3294a7.js";import{bT as k,d as V,ap as $,bG as q,bF as A,aT as y,r as p,aq as a,as as m,o as F,ak as M,al as Q,ar as c,at as r,a4 as d,an as x,au as Y,aA as J,b4 as K,bE as X}from"./index-14be5eda.js";import{u as Z,_ as ee}from"./use-table-height-bb0e75b4.js";import{_ as te}from"./InputGroup-df4b06c1.js";import{N as v}from"./GradientText-e0a89834.js";import{a as T}from"./Select-fe2401fd.js";import{_ as se}from"./Input-3ed2969b.js";import{_ as ae}from"./Space-6bd69fc7.js";import"./Checkbox-e432fb9b.js";import"./Dropdown-be157d33.js";function ne(n){return k.get("/cluster/members",{params:n})}function oe(n){return k.delete(`/cluster/deregister/${n}`)}const re={class:"h-full overflow-hidden"};function ie(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!X(n)}const ye=V({__name:"index",setup(n){const{t}=$(),{warning:z}=q(),{hasPermission:P}=A(),{loading:_,startLoading:w,endLoading:S}=G(!1),{tableHeight:C,initTableHeight:D}=Z(),o=y({address:"",page:0,size:10}),g=p(),f=p([]),h=[];P("DELETE","SETTING")&&h.push({key:"actions",title:()=>t("message.table.operation"),align:"center",width:200,render:e=>{let s;return a(d,{size:"small",onClick:()=>E(e.id)},ie(s=t("message.cluster.offline"))?s:{default:()=>[s]})}});const N=p([{key:"id",title:()=>t("message.cluster.id"),width:70},{key:"ip",title:()=>t("message.cluster.server"),align:"center",maxWidth:100,resizable:!0,ellipsis:{tooltip:!0},render:e=>a(v,null,{default:()=>[e.ip,m(":"),e.port]})},{key:"outerPort",title:()=>t("message.cluster.outerPort"),align:"center",resizable:!0,maxWidth:70,ellipsis:{tooltip:!0},render:e=>a(v,null,{default:()=>[e.outerPort]})},{key:"state",title:()=>t("message.cluster.state"),align:"center",resizable:!0,maxWidth:120,render:e=>a(T,{type:H(e.state)},{default:()=>[e.state]})},{key:"extendInfo",title:()=>t("message.cluster.version"),align:"center",resizable:!0,maxWidth:120,ellipsis:{tooltip:!0},render:e=>a(T,null,{default:()=>{var s;return[(s=e.extendInfo)==null?void 0:s.version]}})},...h]),l=y({page:1,pageSize:o.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:e=>{l.page=e,o.page=e-1,i()},onUpdatePageSize:e=>{o.size!==e&&(l.page=1,l.pageSize=e,o.page=0,o.size=e,i())}});F(()=>{D(g),i()});async function i(){w();const{data:e}=await ne(o);e?(b(e.records),L(e)):b([]),S()}function b(e){f.value=e.map(s=>({...s,key:s.id}))}async function E(e){z({title:t("message.tip._value"),content:t("message.cluster.confirmOffline"),positiveButtonProps:{type:"primary"},positiveText:t("message.operation.confirm"),negativeText:t("message.operation.cancel"),onPositiveClick:async()=>{var u;const{error:s}=await oe(e);s||((u=window.$message)==null||u.success(t("message.cluster.offlineSuccess")),i())}})}function L(e){l.itemCount=e.total}function H(e){switch(e){case"UP":return"success";case"UNHEALTHY":return"warning";case"DOWN":return"error";default:return"default"}}return(e,s)=>{const u=se,W=te,j=R,I=ae,O=ee,U=K;return M(),Q("div",re,[a(U,{bordered:!1,class:"rounded-8px shadow-sm"},{default:c(()=>[a(I,{class:"pb-12px",justify:"space-between"},{default:c(()=>[a(W,{style:{width:"120%"}},{default:c(()=>[a(u,{value:o.address,"onUpdate:value":s[0]||(s[0]=B=>o.address=B),maxlength:"50",placeholder:r(t)("message.cluster.serverPlaceholder")},null,8,["value","placeholder"]),a(r(d),{type:"primary",ghost:"",onClick:i},{default:c(()=>[m(x(r(t)("message.operation.search")),1)]),_:1})]),_:1}),a(r(d),{size:"small",type:"primary",onClick:i},{default:c(()=>[a(j,{class:Y(["mr-4px text-16px",{"animate-spin":r(_)}])},null,8,["class"]),m(" "+x(r(t)("message.table.refresh")),1)]),_:1})]),_:1}),a(O,{ref_key:"tableRef",ref:g,columns:N.value,data:f.value,loading:r(_),pagination:l,style:J({height:`${r(C)}px`}),"flex-height":"",remote:""},null,8,["columns","data","loading","pagination","style"])]),_:1})])}}});export{ye as default};
