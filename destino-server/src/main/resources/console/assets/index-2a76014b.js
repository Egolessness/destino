import{u as ft,_ as ht}from"./refresh-8cb36cef.js";import{_ as gt}from"./round-delete-ac6e9f26.js";import{_ as bt,a as yt}from"./round-plus-57aa32c9.js";import{aZ as rn,a_ as mt,a$ as vt,b0 as mn,b1 as Rn,b2 as pt,b3 as kt,b4 as xt,b5 as Sn,b6 as He,b7 as wt,b8 as vn,b9 as ln,ba as _t,bb as Ct,d as ue,h as T,G as Nn,H as Se,bc as Rt,bd as St,N as Nt,r as I,Z as nn,j as Q,be as Kt,a0 as ee,o as Kn,bf as Dt,bg as Tt,a1 as Et,b as U,g as ge,e as G,a5 as pn,P as Re,a4 as Te,bh as tn,u as At,bi as Pt,k as Dn,w as Ee,t as B,i as Ae,S as Lt,n as Ot,bj as Ft,bk as kn,s as Bt,bl as It,v as an,Y as ae,ag as Tn,bm as $t,aJ as We,ab as qe,an as on,ai as ne,ah as D,ak as z,_ as me,aj as Pe,ae as Le,bn as Ut,bo as zt,as as Mt,bp as jt,bq as Ve,br as Ht,aL as En,bs as An,at as qt,bt as Vt,bu as Wt,bv as Gt,bw as Yt,ac as Xt,W as xn,al as Zt,ar as Qt,bx as Jt,by as ea,aW as na,bz as ta}from"./index-10b862f4.js";import{a as Pn}from"./business-8dae4e68.js";import{u as aa,_ as la}from"./use-table-height-1a043db3.js";import{c as ia}from"./rule-08c6f45b.js";import{_ as oa}from"./Checkbox-4dc29fdd.js";import{h as ra,i as wn,u as ze,e as da,j as _n,k as sa,_ as ca,N as Ln}from"./Input-facf482e.js";import{V as ua,N as fa}from"./Select-ddad6208.js";import{_ as ye}from"./Space-73163714.js";import{a as ha}from"./Grid-f84db2db.js";import{a as ga}from"./FormItem-ee5a7092.js";import{N as ba}from"./GradientText-69fd17e2.js";import"./Dropdown-4d48d12f.js";function On(e){return typeof e=="string"?`s-${e}`:`n-${e}`}function ya(e,t){var i={};return t=rn(t),mt(e,function(o,d,r){vt(i,d,t(o,d,r))}),i}function ma(e,t,i,o){if(!mn(e))return e;t=Rn(t,e);for(var d=-1,r=t.length,h=r-1,m=e;m!=null&&++d<r;){var u=pt(t[d]),y=i;if(u==="__proto__"||u==="constructor"||u==="prototype")return e;if(d!=h){var s=m[u];y=o?o(s,u,m):void 0,y===void 0&&(y=mn(s)?s:kt(t[d+1])?[]:{})}xt(m,u,y),m=m[u]}return e}function va(e,t,i){for(var o=-1,d=t.length,r={};++o<d;){var h=t[o],m=Sn(e,h);i(m,h)&&ma(r,Rn(h,e),m)}return r}function pa(e,t){if(e==null)return{};var i=He(wt(e),function(o){return[o]});return t=rn(t),va(e,i,function(o,d){return t(o,d[0])})}function ka(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}function xa(e,t){if(e!==t){var i=e!==void 0,o=e===null,d=e===e,r=vn(e),h=t!==void 0,m=t===null,u=t===t,y=vn(t);if(!m&&!y&&!r&&e>t||r&&h&&u&&!m&&!y||o&&h&&u||!i&&u||!d)return 1;if(!o&&!r&&!y&&e<t||y&&i&&d&&!o&&!r||m&&i&&d||!h&&d||!u)return-1}return 0}function wa(e,t,i){for(var o=-1,d=e.criteria,r=t.criteria,h=d.length,m=i.length;++o<h;){var u=xa(d[o],r[o]);if(u){if(o>=m)return u;var y=i[o];return u*(y=="desc"?-1:1)}}return e.index-t.index}function _a(e,t,i){t.length?t=He(t,function(r){return ln(r)?function(h){return Sn(h,r.length===1?r[0]:r)}:r}):t=[_t];var o=-1;t=He(t,Ct(rn));var d=ra(e,function(r,h,m){var u=He(t,function(y){return y(r)});return{criteria:u,index:++o,value:r}});return ka(d,function(r,h){return wa(r,h,i)})}function Ca(e,t,i,o){return e==null?[]:(ln(t)||(t=t==null?[]:[t]),i=o?void 0:i,ln(i)||(i=i==null?[]:[i]),_a(e,t,i))}const Ra=ue({name:"Switcher",render(){return T("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},T("path",{d:"M12 8l10 8l-10 8z"}))}}),Fn=Nn("n-tree-select"),Oe=Nn("n-tree"),Sa=ue({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:t}=Se(Oe,null);return()=>{const{clsPrefix:i}=e;return T("span",{"data-switcher":!0,class:[`${i}-tree-node-switcher`,e.expanded&&`${i}-tree-node-switcher--expanded`,e.hide&&`${i}-tree-node-switcher--hide`],onClick:e.onClick},T("div",{class:`${i}-tree-node-switcher__icon`},T(Rt,null,{default:()=>{if(e.loading)return T(St,{clsPrefix:i,key:"loading",radius:85,strokeWidth:20});const{value:o}=t;return o?o({expanded:e.expanded,selected:e.selected}):T(Nt,{clsPrefix:i,key:"switcher"},{default:()=>T(Ra,null)})}})))}}}),Na=ue({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const t=Se(Oe);function i(d){const{onCheck:r}=e;r&&r(d)}function o(d){e.indeterminate?i(!1):i(d)}return{handleUpdateValue:o,mergedTheme:t.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:t,checked:i,indeterminate:o,disabled:d,focusable:r,handleUpdateValue:h}=this;return T("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},T(oa,{focusable:r,disabled:d,theme:t.peers.Checkbox,themeOverrides:t.peerOverrides.Checkbox,checked:i,indeterminate:o,onUpdateChecked:h}))}}),Ka=ue({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:t,renderPrefixRef:i,renderSuffixRef:o,labelFieldRef:d}=Se(Oe),r=I(null);function h(u){const{onClick:y}=e;y&&y(u)}function m(u){h(u)}return{selfRef:r,renderLabel:t,renderPrefix:i,renderSuffix:o,labelField:d,handleClick:m}},render(){const{clsPrefix:e,labelField:t,nodeProps:i,checked:o=!1,selected:d=!1,renderLabel:r,renderPrefix:h,renderSuffix:m,handleClick:u,onDragstart:y,tmNode:{rawNode:s,rawNode:{prefix:_,suffix:w,[t]:b}}}=this;return T("span",Object.assign({},i,{ref:"selfRef",class:[`${e}-tree-node-content`,i==null?void 0:i.class],onClick:u,draggable:y===void 0?void 0:!0,onDragstart:y}),h||_?T("div",{class:`${e}-tree-node-content__prefix`},h?h({option:s,selected:d,checked:o}):nn(_)):null,T("div",{class:`${e}-tree-node-content__text`},r?r({option:s,selected:d,checked:o}):nn(b)),m||w?T("div",{class:`${e}-tree-node-content__suffix`},m?m({option:s,selected:d,checked:o}):nn(w)):null)}});function Cn({position:e,offsetLevel:t,indent:i,el:o}){const d={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")d.left=0,d.top=0,d.bottom=0,d.borderRadius="inherit",d.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const r=e==="before"?"top":"bottom";d[r]=0,d.left=`${o.offsetLeft+6-t*i}px`,d.height="2px",d.backgroundColor="var(--n-drop-mark-color)",d.transformOrigin=r,d.borderRadius="1px",d.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return T("div",{style:d})}function Da({dropPosition:e,node:t}){return t.isLeaf===!1||t.children?!0:e!=="inside"}function Ta(e){return Q(()=>e.leafOnly?"child":e.checkStrategy)}function be(e,t){return!!e.rawNode[t]}function Bn(e,t,i,o){e==null||e.forEach(d=>{i(d),Bn(d[t],t,i,o),o(d)})}function Ea(e,t,i,o,d){const r=new Set,h=new Set,m=[];return Bn(e,o,u=>{if(m.push(u),d(t,u)){h.add(u[i]);for(let y=m.length-2;y>=0;--y)if(!r.has(m[y][i]))r.add(m[y][i]);else return}},()=>{m.pop()}),{expandedKeys:Array.from(r),highlightKeySet:h}}if(Kt&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function Aa(e,t,i,o,d){const r=new Set,h=new Set,m=new Set,u=[],y=[],s=[];function _(b){b.forEach(x=>{if(s.push(x),t(i,x)){r.add(x[o]),m.add(x[o]);for(let N=s.length-2;N>=0;--N){const O=s[N][o];if(!h.has(O))h.add(O),r.has(O)&&r.delete(O);else break}}const C=x[d];C&&_(C),s.pop()})}_(e);function w(b,x){b.forEach(C=>{const N=C[o],O=r.has(N),F=h.has(N);if(!O&&!F)return;const Y=C[d];if(Y)if(O)x.push(C);else{u.push(N);const j=Object.assign(Object.assign({},C),{[d]:[]});x.push(j),w(Y,j[d])}else x.push(C)})}return w(e,y),{filteredTree:y,highlightKeySet:m,expandedKeys:u}}const Pa=ue({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const t=Se(Oe),{droppingNodeParentRef:i,droppingMouseNodeRef:o,draggingNodeRef:d,droppingPositionRef:r,droppingOffsetLevelRef:h,nodePropsRef:m,indentRef:u,blockLineRef:y,checkboxPlacementRef:s,checkOnClickRef:_,disabledFieldRef:w}=t,b=ee(()=>!!e.tmNode.rawNode.checkboxDisabled),x=ee(()=>be(e.tmNode,w.value)),C=ee(()=>t.disabledRef.value||x.value),N=Q(()=>{const{value:l}=m;if(l)return l({option:e.tmNode.rawNode})}),O=I(null),F={value:null};Kn(()=>{F.value=O.value.$el});function Y(){const{tmNode:l}=e;if(!l.isLeaf&&!l.shallowLoaded){if(!t.loadingKeysRef.value.has(l.key))t.loadingKeysRef.value.add(l.key);else return;const{onLoadRef:{value:p}}=t;p&&p(l.rawNode).then(v=>{v!==!1&&t.handleSwitcherClick(l)}).finally(()=>{t.loadingKeysRef.value.delete(l.key)})}else t.handleSwitcherClick(l)}const j=ee(()=>!x.value&&t.selectableRef.value&&(t.internalTreeSelect?t.mergedCheckStrategyRef.value!=="child"||t.multipleRef.value&&t.cascadeRef.value||e.tmNode.isLeaf:!0)),J=ee(()=>t.checkableRef.value&&(t.cascadeRef.value||t.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),le=ee(()=>t.displayedCheckedKeysRef.value.includes(e.tmNode.key)),k=ee(()=>{const{value:l}=J;if(!l)return!1;const{value:p}=_;return typeof p=="boolean"?p:p(e.tmNode.rawNode)});function S(l){const{value:p}=t.expandOnClickRef,{value:v}=j,{value:q}=k;if(!v&&!p&&!q||wn(l,"checkbox")||wn(l,"switcher"))return;const{tmNode:re}=e;v&&t.handleSelect(re),p&&!re.isLeaf&&Y(),q&&V(!le.value)}function K(l){var p,v;y.value||(C.value||S(l),(v=(p=N.value)===null||p===void 0?void 0:p.onClick)===null||v===void 0||v.call(p,l))}function E(l){var p,v;y.value&&(C.value||S(l),(v=(p=N.value)===null||p===void 0?void 0:p.onClick)===null||v===void 0||v.call(p,l))}function V(l){t.handleCheck(e.tmNode,l)}function P(l){t.handleDragStart({event:l,node:e.tmNode})}function A(l){l.currentTarget===l.target&&t.handleDragEnter({event:l,node:e.tmNode})}function R(l){l.preventDefault(),t.handleDragOver({event:l,node:e.tmNode})}function H(l){t.handleDragEnd({event:l,node:e.tmNode})}function $(l){l.currentTarget===l.target&&t.handleDragLeave({event:l,node:e.tmNode})}function oe(l){l.preventDefault(),r.value!==null&&t.handleDrop({event:l,node:e.tmNode,dropPosition:r.value})}return{showDropMark:ee(()=>{const{value:l}=d;if(!l)return;const{value:p}=r;if(!p)return;const{value:v}=o;if(!v)return;const{tmNode:q}=e;return q.key===v.key}),showDropMarkAsParent:ee(()=>{const{value:l}=i;if(!l)return!1;const{tmNode:p}=e,{value:v}=r;return v==="before"||v==="after"?l.key===p.key:!1}),pending:ee(()=>t.pendingNodeKeyRef.value===e.tmNode.key),loading:ee(()=>t.loadingKeysRef.value.has(e.tmNode.key)),highlight:ee(()=>{var l;return(l=t.highlightKeySetRef.value)===null||l===void 0?void 0:l.has(e.tmNode.key)}),checked:le,indeterminate:ee(()=>t.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:ee(()=>t.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:ee(()=>t.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:C,checkable:J,mergedCheckOnClick:k,checkboxDisabled:b,selectable:j,expandOnClick:t.expandOnClickRef,internalScrollable:t.internalScrollableRef,draggable:t.draggableRef,blockLine:y,nodeProps:N,checkboxFocusable:t.internalCheckboxFocusableRef,droppingPosition:r,droppingOffsetLevel:h,indent:u,checkboxPlacement:s,contentInstRef:O,contentElRef:F,handleCheck:V,handleDrop:oe,handleDragStart:P,handleDragEnter:A,handleDragOver:R,handleDragEnd:H,handleDragLeave:$,handleLineClick:E,handleContentClick:K,handleSwitcherClick:Y}},render(){const{tmNode:e,clsPrefix:t,checkable:i,expandOnClick:o,selectable:d,selected:r,checked:h,highlight:m,draggable:u,blockLine:y,indent:s,disabled:_,pending:w,internalScrollable:b,nodeProps:x,checkboxPlacement:C}=this,N=u&&!_?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,O=b?On(e.key):void 0,F=C==="right",Y=i?T(Na,{right:F,focusable:this.checkboxFocusable,disabled:_||this.checkboxDisabled,clsPrefix:t,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return T("div",Object.assign({class:`${t}-tree-node-wrapper`},N),T("div",Object.assign({},y?x:void 0,{class:[`${t}-tree-node`,{[`${t}-tree-node--selected`]:r,[`${t}-tree-node--checkable`]:i,[`${t}-tree-node--highlight`]:m,[`${t}-tree-node--pending`]:w,[`${t}-tree-node--disabled`]:_,[`${t}-tree-node--selectable`]:d,[`${t}-tree-node--clickable`]:d||o||this.mergedCheckOnClick},x==null?void 0:x.class],"data-key":O,draggable:u&&y,onClick:this.handleLineClick,onDragstart:u&&y&&!_?this.handleDragStart:void 0}),Dt(e.level,T("div",{class:`${t}-tree-node-indent`},T("div",{style:{width:`${s}px`}}))),T(Sa,{clsPrefix:t,expanded:this.expanded,selected:r,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),F?null:Y,T(Ka,{ref:"contentInstRef",clsPrefix:t,checked:h,selected:r,onClick:this.handleContentClick,nodeProps:y?void 0:x,onDragstart:u&&!y&&!_?this.handleDragStart:void 0,tmNode:e}),u?this.showDropMark?Cn({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:s}):this.showDropMarkAsParent?Cn({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:s}):null:null,F?Y:null))}}),In=Pa;function La({props:e,fNodesRef:t,mergedExpandedKeysRef:i,mergedSelectedKeysRef:o,handleSelect:d,handleSwitcherClick:r}){const{value:h}=o,m=Se(Fn,null),u=m?m.pendingNodeKeyRef:I(h.length?h[h.length-1]:null);function y(s){if(!e.keyboard)return;const{value:_}=u;if(_===null){if((s.key==="ArrowDown"||s.key==="ArrowUp")&&s.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(s.key)&&_===null){const{value:w}=t;let b=0;for(;b<w.length;){if(!w[b].disabled){u.value=w[b].key;break}b+=1}}}else{const{value:w}=t;let b=w.findIndex(x=>x.key===_);if(!~b)return;if(s.key==="Enter")d(w[b]);else if(s.key==="ArrowDown")for(s.preventDefault(),b+=1;b<w.length;){if(!w[b].disabled){u.value=w[b].key;break}b+=1}else if(s.key==="ArrowUp")for(s.preventDefault(),b-=1;b>=0;){if(!w[b].disabled){u.value=w[b].key;break}b-=1}else if(s.key==="ArrowLeft"){const x=w[b];if(x.isLeaf||!i.value.includes(_)){const C=x.getParent();C&&(u.value=C.key)}else r(x)}else if(s.key==="ArrowRight"){const x=w[b];if(x.isLeaf)return;if(!i.value.includes(_))r(x);else for(b+=1;b<w.length;){if(!w[b].disabled){u.value=w[b].key;break}b+=1}}}}return{pendingNodeKeyRef:u,handleKeydown:y}}const Oa=ue({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return T(Et,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>T("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:Tt(this.height)}},this.nodes.map(t=>T(In,{clsPrefix:e,tmNode:t})))})}}),Fa=U("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[ge("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),ge(">",[U("tree-node",[ge("&:first-child",{marginTop:0})])]),U("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 height: 0;
 `),U("tree-motion-wrapper",[G("expand",[pn({duration:"0.2s"})]),G("collapse",[pn({duration:"0.2s",reverse:!0})])]),U("tree-node-wrapper",`
 box-sizing: border-box;
 padding: 3px 0;
 `),U("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[G("highlight",[U("tree-node-content",[Re("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),G("disabled",[U("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),Te("disabled",[G("clickable",[U("tree-node-content",`
 cursor: pointer;
 `)])])]),G("block-node",[U("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),Te("block-line",[U("tree-node",[Te("disabled",[U("tree-node-content",[ge("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),G("selectable",[U("tree-node-content",[ge("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),G("pending",[U("tree-node-content",`
 background-color: var(--n-node-color-hover);
 `)]),G("selected",[U("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),G("block-line",[U("tree-node",[Te("disabled",[ge("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),G("pending",`
 background-color: var(--n-node-color-hover);
 `),G("selectable",[Te("selected",[ge("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),G("selected",{backgroundColor:"var(--n-node-color-active)"})]),G("disabled",`
 cursor: not-allowed;
 `)])]),U("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: 24px;
 width: 24px;
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[Re("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[U("icon",[tn()]),U("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[tn()]),U("base-icon",[tn()])]),G("hide",{visibility:"hidden"}),G("expanded",{transform:"rotate(90deg)"})]),U("tree-node-checkbox",`
 display: inline-flex;
 height: 24px;
 width: 16px;
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 margin-right: 4px;
 `,[G("right","margin-left: 4px;")]),G("checkable",[U("tree-node-content",`
 padding: 0 6px;
 `)]),U("tree-node-content",`
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: 24px;
 box-sizing: border-box;
 line-height: 1.5;
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 text-decoration-color: #0000;
 text-decoration-line: underline;
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[ge("&:last-child",{marginBottom:0}),Re("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),Re("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),Re("suffix",`
 display: inline-flex;
 `)]),Re("empty","margin: auto;")]);var Ba=globalThis&&globalThis.__awaiter||function(e,t,i,o){function d(r){return r instanceof i?r:new i(function(h){h(r)})}return new(i||(i=Promise))(function(r,h){function m(s){try{y(o.next(s))}catch(_){h(_)}}function u(s){try{y(o.throw(s))}catch(_){h(_)}}function y(s){s.done?r(s.value):d(s.value).then(m,u)}y((o=o.apply(e,t||[])).next())})};const Me=30;function Ia(e,t,i,o){return{getIsGroup(){return!1},getKey(r){return r[e]},getChildren:o||(r=>r[t]),getDisabled(r){return!!(r[i]||r.checkboxDisabled)}}}const $a={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},Ua=Object.assign(Object.assign(Object.assign(Object.assign({},Dn.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:Da},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),$a),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),$n=ue({name:"Tree",props:Ua,setup(e){const{mergedClsPrefixRef:t,inlineThemeDisabled:i,mergedRtlRef:o}=At(e),d=Pt("Tree",o,t),r=Dn("Tree","-tree",Fa,It,e,t),h=I(null),m=I(null),u=I(null);function y(){var n;return(n=u.value)===null||n===void 0?void 0:n.listElRef}function s(){var n;return(n=u.value)===null||n===void 0?void 0:n.itemsElRef}const _=Q(()=>{const{filter:n}=e;if(n)return n;const{labelField:a}=e;return(c,f)=>{if(!c.length)return!0;const g=f[a];return typeof g=="string"?g.toLowerCase().includes(c.toLowerCase()):!1}}),w=Q(()=>{const{pattern:n}=e;return n?!n.length||!_.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:Aa(e.data,_.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),b=Q(()=>da(e.showIrrelevantNodes?e.data:w.value.filteredTree,Ia(e.keyField,e.childrenField,e.disabledField,e.getChildren))),x=Se(Fn,null),C=e.internalTreeSelect?x.dataTreeMate:b,{watchProps:N}=e,O=I([]);N!=null&&N.includes("defaultCheckedKeys")?Ee(()=>{O.value=e.defaultCheckedKeys}):O.value=e.defaultCheckedKeys;const F=B(e,"checkedKeys"),Y=ze(F,O),j=Q(()=>C.value.getCheckedKeys(Y.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),J=Ta(e),le=Q(()=>j.value.checkedKeys),k=Q(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:j.value.indeterminateKeys}),S=I([]);N!=null&&N.includes("defaultSelectedKeys")?Ee(()=>{S.value=e.defaultSelectedKeys}):S.value=e.defaultSelectedKeys;const K=B(e,"selectedKeys"),E=ze(K,S),V=I([]),P=n=>{V.value=e.defaultExpandAll?C.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};N!=null&&N.includes("defaultExpandedKeys")?Ee(()=>{P(void 0)}):Ee(()=>{P(e.defaultExpandedKeys)});const A=B(e,"expandedKeys"),R=ze(A,V),H=Q(()=>b.value.getFlattenedNodes(R.value)),{pendingNodeKeyRef:$,handleKeydown:oe}=La({props:e,mergedSelectedKeysRef:E,fNodesRef:H,mergedExpandedKeysRef:R,handleSelect:Qe,handleSwitcherClick:un});let l=null,p=null;const v=I(new Set),q=Q(()=>e.internalHighlightKeySet||w.value.highlightKeySet),re=ze(q,v),se=I(new Set),Ge=Q(()=>R.value.filter(n=>!se.value.has(n)));let Ne=0;const ve=I(null),Fe=I(null),Be=I(null),Ie=I(null),$e=I(0),Un=Q(()=>{const{value:n}=Fe;return n?n.parent:null});Ae(B(e,"data"),()=>{se.value.clear(),$.value=null,De()},{deep:!1});let Ye=!1;const Xe=()=>{Ye=!0,an(()=>{Ye=!1})};let Ke;Ae(B(e,"pattern"),(n,a)=>{if(e.showIrrelevantNodes)if(Ke=void 0,n){const{expandedKeys:c,highlightKeySet:f}=Ea(e.data,e.pattern,e.keyField,e.childrenField,_.value);v.value=f,Xe(),we(c,ie(c),{node:null,action:"filter"})}else v.value=new Set;else if(!n.length)Ke!==void 0&&(Xe(),we(Ke,ie(Ke),{node:null,action:"filter"}));else{a.length||(Ke=R.value);const{expandedKeys:c}=w.value;c!==void 0&&(Xe(),we(c,ie(c),{node:null,action:"filter"}))}});function dn(n){return Ba(this,void 0,void 0,function*(){const{onLoad:a}=e;if(!a){yield Promise.resolve();return}const{value:c}=se;if(!c.has(n.key)){c.add(n.key);try{(yield a(n.rawNode))===!1&&_e()}catch(f){console.error(f),_e()}c.delete(n.key)}})}Ee(()=>{var n;const{value:a}=b;if(!a)return;const{getNode:c}=a;(n=R.value)===null||n===void 0||n.forEach(f=>{const g=c(f);g&&!g.shallowLoaded&&dn(g)})});const xe=I(!1),fe=I([]);Ae(Ge,(n,a)=>{if(!e.animated||Ye){an(Ue);return}const c=new Set(a);let f=null,g=null;for(const M of n)if(!c.has(M)){if(f!==null)return;f=M}const X=new Set(n);for(const M of a)if(!X.has(M)){if(g!==null)return;g=M}if(f===null&&g===null)return;const{virtualScroll:W}=e,ce=(W?u.value.listElRef:h.value).offsetHeight,ke=Math.ceil(ce/Me)+1;let de;if(f!==null&&(de=a),g!==null&&(de===void 0?de=n:de=de.filter(M=>M!==g)),xe.value=!0,fe.value=b.value.getFlattenedNodes(de),f!==null){const M=fe.value.findIndex(Z=>Z.key===f);if(~M){const Z=fe.value[M].children;if(Z){const he=_n(Z,n);fe.value.splice(M+1,0,{__motion:!0,mode:"expand",height:W?he.length*Me:void 0,nodes:W?he.slice(0,ke):he})}}}if(g!==null){const M=fe.value.findIndex(Z=>Z.key===g);if(~M){const Z=fe.value[M].children;if(!Z)return;xe.value=!0;const he=_n(Z,n);fe.value.splice(M+1,0,{__motion:!0,mode:"collapse",height:W?he.length*Me:void 0,nodes:W?he.slice(0,ke):he})}}});const zn=Q(()=>sa(H.value)),Mn=Q(()=>xe.value?fe.value:H.value);function Ue(){const{value:n}=m;n&&n.sync()}function jn(){xe.value=!1,e.virtualScroll&&an(Ue)}function ie(n){const{getNode:a}=C.value;return n.map(c=>{var f;return((f=a(c))===null||f===void 0?void 0:f.rawNode)||null})}function we(n,a,c){const{"onUpdate:expandedKeys":f,onUpdateExpandedKeys:g}=e;V.value=n,f&&ae(f,n,a,c),g&&ae(g,n,a,c)}function sn(n,a,c){const{"onUpdate:checkedKeys":f,onUpdateCheckedKeys:g}=e;O.value=n,g&&ae(g,n,a,c),f&&ae(f,n,a,c)}function Hn(n,a){const{"onUpdate:indeterminateKeys":c,onUpdateIndeterminateKeys:f}=e;c&&ae(c,n,a),f&&ae(f,n,a)}function Ze(n,a,c){const{"onUpdate:selectedKeys":f,onUpdateSelectedKeys:g}=e;S.value=n,g&&ae(g,n,a,c),f&&ae(f,n,a,c)}function qn(n){const{onDragenter:a}=e;a&&ae(a,n)}function Vn(n){const{onDragleave:a}=e;a&&ae(a,n)}function Wn(n){const{onDragend:a}=e;a&&ae(a,n)}function Gn(n){const{onDragstart:a}=e;a&&ae(a,n)}function Yn(n){const{onDragover:a}=e;a&&ae(a,n)}function Xn(n){const{onDrop:a}=e;a&&ae(a,n)}function De(){Zn(),pe()}function Zn(){ve.value=null}function pe(){$e.value=0,Fe.value=null,Be.value=null,Ie.value=null,_e()}function _e(){l&&(window.clearTimeout(l),l=null),p=null}function cn(n,a){if(e.disabled||be(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple){Qe(n);return}const c=a?"check":"uncheck",{checkedKeys:f,indeterminateKeys:g}=C.value[c](n.key,le.value,{cascade:e.cascade,checkStrategy:J.value,allowNotLoaded:e.allowCheckingNotLoaded});sn(f,ie(f),{node:n.rawNode,action:c}),Hn(g,ie(g))}function Qn(n){if(e.disabled)return;const{key:a}=n,{value:c}=R,f=c.findIndex(g=>g===a);if(~f){const g=Array.from(c);g.splice(f,1),we(g,ie(g),{node:n.rawNode,action:"collapse"})}else{const g=b.value.getNode(a);if(!g||g.isLeaf)return;let X;if(e.accordion){const W=new Set(n.siblings.map(({key:ce})=>ce));X=c.filter(ce=>!W.has(ce)),X.push(a)}else X=c.concat(a);we(X,ie(X),{node:n.rawNode,action:"expand"})}}function un(n){e.disabled||xe.value||Qn(n)}function Qe(n){if(!(e.disabled||!e.selectable)){if($.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:a,indeterminateKeys:c}}=j;e.multiple?cn(n,!(a.includes(n.key)||c.includes(n.key))):sn([n.key],ie([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const a=Array.from(E.value),c=a.findIndex(f=>f===n.key);~c?e.cancelable&&a.splice(c,1):~c||a.push(n.key),Ze(a,ie(a),{node:n.rawNode,action:~c?"unselect":"select"})}else E.value.includes(n.key)?e.cancelable&&Ze([],[],{node:n.rawNode,action:"unselect"}):Ze([n.key],ie([n.key]),{node:n.rawNode,action:"select"})}}function Jn(n){if(l&&(window.clearTimeout(l),l=null),n.isLeaf)return;p=n.key;const a=()=>{if(p!==n.key)return;const{value:c}=Be;if(c&&c.key===n.key&&!R.value.includes(n.key)){const f=R.value.concat(n.key);we(f,ie(f),{node:n.rawNode,action:"expand"})}l=null,p=null};n.shallowLoaded?l=window.setTimeout(()=>{a()},1e3):l=window.setTimeout(()=>{dn(n).then(()=>{a()})},1e3)}function et({event:n,node:a}){!e.draggable||e.disabled||be(a,e.disabledField)||(fn({event:n,node:a},!1),qn({event:n,node:a.rawNode}))}function nt({event:n,node:a}){!e.draggable||e.disabled||be(a,e.disabledField)||Vn({event:n,node:a.rawNode})}function tt(n){n.target===n.currentTarget&&pe()}function at({event:n,node:a}){De(),!(!e.draggable||e.disabled||be(a,e.disabledField))&&Wn({event:n,node:a.rawNode})}function lt({event:n,node:a}){!e.draggable||e.disabled||be(a,e.disabledField)||(Ne=n.clientX,ve.value=a,Gn({event:n,node:a.rawNode}))}function fn({event:n,node:a},c=!0){var f;if(!e.draggable||e.disabled||be(a,e.disabledField))return;const{value:g}=ve;if(!g)return;const{allowDrop:X,indent:W}=e;c&&Yn({event:n,node:a.rawNode});const ce=n.currentTarget,{height:ke,top:de}=ce.getBoundingClientRect(),M=n.clientY-de;let Z;X({node:a.rawNode,dropPosition:"inside",phase:"drag"})?M<=8?Z="before":M>=ke-8?Z="after":Z="inside":M<=ke/2?Z="before":Z="after";const{value:ut}=zn;let L,te;const Je=ut(a.key);if(Je===null){pe();return}let gn=!1;Z==="inside"?(L=a,te="inside"):Z==="before"?a.isFirstChild?(L=a,te="before"):(L=H.value[Je-1],te="after"):(L=a,te="after"),!L.isLeaf&&R.value.includes(L.key)&&(gn=!0,te==="after"&&(L=H.value[Je+1],L?te="before":(L=a,te="inside")));const bn=L;if(Be.value=bn,!gn&&g.isLastChild&&g.key===L.key&&(te="after"),te==="after"){let yn=Ne-n.clientX,en=0;for(;yn>=W/2&&L.parent!==null&&L.isLastChild&&en<1;)yn-=W,en+=1,L=L.parent;$e.value=en}else $e.value=0;if((g.contains(L)||te==="inside"&&((f=g.parent)===null||f===void 0?void 0:f.key)===L.key)&&!(g.key===bn.key&&g.key===L.key)){pe();return}if(!X({node:L.rawNode,dropPosition:te,phase:"drag"})){pe();return}if(g.key===L.key)_e();else if(p!==L.key)if(te==="inside"){if(e.expandOnDragenter){if(Jn(L),!L.shallowLoaded&&p!==L.key){De();return}}else if(!L.shallowLoaded){De();return}}else _e();else te!=="inside"&&_e();Ie.value=te,Fe.value=L}function it({event:n,node:a,dropPosition:c}){if(!e.draggable||e.disabled||be(a,e.disabledField))return;const{value:f}=ve,{value:g}=Fe,{value:X}=Ie;if(!(!f||!g||!X)&&e.allowDrop({node:g.rawNode,dropPosition:X,phase:"drag"})&&f.key!==g.key){if(X==="before"){const W=f.getNext({includeDisabled:!0});if(W&&W.key===g.key){pe();return}}if(X==="after"){const W=f.getPrev({includeDisabled:!0});if(W&&W.key===g.key){pe();return}}Xn({event:n,node:g.rawNode,dragNode:f.rawNode,dropPosition:c}),De()}}function ot(){Ue()}function rt(){Ue()}function dt(n){var a;if(e.virtualScroll||e.internalScrollable){const{value:c}=m;if(!((a=c==null?void 0:c.containerRef)===null||a===void 0)&&a.contains(n.relatedTarget))return;$.value=null}else{const{value:c}=h;if(c!=null&&c.contains(n.relatedTarget))return;$.value=null}}Ae($,n=>{var a,c;if(n!==null){if(e.virtualScroll)(a=u.value)===null||a===void 0||a.scrollTo({key:n});else if(e.internalScrollable){const{value:f}=m;if(f===null)return;const g=(c=f.contentRef)===null||c===void 0?void 0:c.querySelector(`[data-key="${On(n)}"]`);if(!g)return;f.scrollTo({el:g})}}}),Lt(Oe,{loadingKeysRef:se,highlightKeySetRef:re,displayedCheckedKeysRef:le,displayedIndeterminateKeysRef:k,mergedSelectedKeysRef:E,mergedExpandedKeysRef:R,mergedThemeRef:r,mergedCheckStrategyRef:J,nodePropsRef:B(e,"nodeProps"),disabledRef:B(e,"disabled"),checkableRef:B(e,"checkable"),selectableRef:B(e,"selectable"),expandOnClickRef:B(e,"expandOnClick"),onLoadRef:B(e,"onLoad"),draggableRef:B(e,"draggable"),blockLineRef:B(e,"blockLine"),indentRef:B(e,"indent"),cascadeRef:B(e,"cascade"),checkOnClickRef:B(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Be,droppingNodeParentRef:Un,draggingNodeRef:ve,droppingPositionRef:Ie,droppingOffsetLevelRef:$e,fNodesRef:H,pendingNodeKeyRef:$,disabledFieldRef:B(e,"disabledField"),internalScrollableRef:B(e,"internalScrollable"),internalCheckboxFocusableRef:B(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:B(e,"renderLabel"),renderPrefixRef:B(e,"renderPrefix"),renderSuffixRef:B(e,"renderSuffix"),renderSwitcherIconRef:B(e,"renderSwitcherIcon"),labelFieldRef:B(e,"labelField"),multipleRef:B(e,"multiple"),handleSwitcherClick:un,handleDragEnd:at,handleDragEnter:et,handleDragLeave:nt,handleDragStart:lt,handleDrop:it,handleDragOver:fn,handleSelect:Qe,handleCheck:cn});function st(n){var a;(a=u.value)===null||a===void 0||a.scrollTo(n)}const ct={handleKeydown:oe,scrollTo:st,getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=j.value;return{keys:n,options:ie(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=j.value;return{keys:n,options:ie(n)}}},hn=Q(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:a,nodeBorderRadius:c,nodeColorHover:f,nodeColorPressed:g,nodeColorActive:X,arrowColor:W,loadingColor:ce,nodeTextColor:ke,nodeTextColorDisabled:de,dropMarkColor:M}}=r.value;return{"--n-arrow-color":W,"--n-loading-color":ce,"--n-bezier":n,"--n-font-size":a,"--n-node-border-radius":c,"--n-node-color-active":X,"--n-node-color-hover":f,"--n-node-color-pressed":g,"--n-node-text-color":ke,"--n-node-text-color-disabled":de,"--n-drop-mark-color":M}}),Ce=i?Ot("tree",void 0,hn,e):void 0;return Object.assign(Object.assign({},ct),{mergedClsPrefix:t,mergedTheme:r,rtlEnabled:d,fNodes:Mn,aip:xe,selfElRef:h,virtualListInstRef:u,scrollbarInstRef:m,handleFocusout:dt,handleDragLeaveTree:tt,handleScroll:ot,getScrollContainer:y,getScrollContent:s,handleAfterEnter:jn,handleResize:rt,cssVars:i?void 0:hn,themeClass:Ce==null?void 0:Ce.themeClass,onRender:Ce==null?void 0:Ce.onRender})},render(){var e;const{fNodes:t,internalRenderEmpty:i}=this;if(!t.length&&i)return i();const{mergedClsPrefix:o,blockNode:d,blockLine:r,draggable:h,disabled:m,internalFocusable:u,checkable:y,handleKeydown:s,rtlEnabled:_,handleFocusout:w}=this,b=u&&!m,x=b?"0":void 0,C=[`${o}-tree`,_&&`${o}-tree--rtl`,y&&`${o}-tree--checkable`,(r||d)&&`${o}-tree--block-node`,r&&`${o}-tree--block-line`],N=F=>"__motion"in F?T(Oa,{height:F.height,nodes:F.nodes,clsPrefix:o,mode:F.mode,onAfterEnter:this.handleAfterEnter}):T(In,{key:F.key,tmNode:F,clsPrefix:o});if(this.virtualScroll){const{mergedTheme:F,internalScrollablePadding:Y}=this,j=Ft(Y||"0");return T(kn,{ref:"scrollbarInstRef",onDragleave:h?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:C,theme:F.peers.Scrollbar,themeOverrides:F.peerOverrides.Scrollbar,tabindex:x,onKeydown:b?s:void 0,onFocusout:b?w:void 0},{default:()=>{var J;return(J=this.onRender)===null||J===void 0||J.call(this),T(ua,{ref:"virtualListInstRef",items:this.fNodes,itemSize:Me,ignoreItemResize:this.aip,paddingTop:j.top,paddingBottom:j.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:j.left,paddingRight:j.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:le})=>N(le)})}})}const{internalScrollable:O}=this;return C.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),O?T(kn,{class:C,tabindex:x,onKeydown:b?s:void 0,onFocusout:b?w:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>T("div",{onDragleave:h?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(N))}):T("div",{class:C,tabindex:x,ref:"selfElRef",style:this.cssVars,onKeydown:b?s:void 0,onFocusout:b?w:void 0,onDragleave:h?this.handleDragLeaveTree:void 0},t.length?t.map(N):Bt(this.$slots.empty,()=>[T(fa,{class:`${o}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}});function za(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!An(e)}const Ma=ue({name:"RoleActionModal",__name:"action-modal",props:{visible:{type:Boolean},type:{default:"add"},editData:{default:null}},emits:["update:visible","refresh-table"],setup(e,{emit:t}){const i=e,{t:o}=Tn(),{loadAccesses:d}=$t(),r=Q({get(){return i.visible},set(k){t("update:visible",k)}});function h(k){return We({READ:k?k.includes("READ"):!1,WRITE:k?k.includes("WRITE"):!1,DELETE:k?k.includes("DELETE"):!1})}function m(k,S,K){k&&k.forEach(E=>{E.action[S]=K,m(E.children,S,K)})}function u(k,S,K){k.parent&&(K||(k.parent.action[S]=K,u(k.parent,S,K)))}function y(k,S,K){var V;const E={label:((V=k.label)==null?void 0:V.call(k))||k.path,key:k.path,action:S,isLeaf:Ve(K),children:K};return E.suffix=()=>{let P;return D(ye,{justify:"center",size:2,wrap:!1},za(P=Pn.map(A=>D(Ln,{trigger:"hover",delay:1500},{default:()=>D("span",null,[A.desc]),trigger:()=>D(me,{text:!0,class:"text-18px flex",ghost:!0,"icon-placement":"center",onClick:R=>{R.stopPropagation();const H=!S[A.key];S[A.key]=H,m(K,A.key,H),u(E,A.key,H)}},{icon:()=>D(En,{style:{color:S[A.key]?"#06FF6A":"#BCC3C4"},disabled:!0,class:"text-12px",icon:A.icon},null)})})))?P:{default:()=>[P]})},E}const s=(k,S,K)=>{const E=Ht(S||[],"path"),V=k.map(P=>{const A=E[P.path];delete E[P.path];const R=[];A&&A.actions&&R.push(...A.actions),K&&K.forEach(oe=>{R.includes(oe)||R.push(oe)});const H=s(P.children||[],A==null?void 0:A.sub,R),$=y(P,h(R),H);return H.forEach(oe=>oe.parent=$),$});return Ca(ya(E),["path"]).forEach(P=>{const A=[];P&&P.actions&&A.push(...P.actions),K&&K.forEach($=>{A.includes($)||A.push($)});const R=s([],P.sub,A),H=y(P,h(P.actions),R);V.push(H),R.forEach($=>$.parent=H)}),V},_=()=>{r.value=!1},w=Q(()=>({add:o("message.role.addTitle"),edit:o("message.role.updateTitle")})[i.type]),b=I(),x=We(N()),C={name:ia(()=>o("message.role.name"))};function N(){return{name:"",permissions:[],permissionOptions:[]}}async function O(k){const S=s(await d(),k.permissions,[]);Object.assign(x,{...k,permissionOptions:S})}const F=N();function Y(){({add:()=>{O(F)},edit:()=>{i.editData&&O(i.editData)}})[i.type]()}async function j(){var k,S,K;if(await((k=b.value)==null?void 0:k.validate()),i.type==="add"){const{error:E}=await Ut(le());E||((S=window.$message)==null||S.success(o("message.operation.addSuccess")),t("refresh-table"),_())}else if(i.editData){const{error:E}=await zt(i.editData.id,le());E||((K=window.$message)==null||K.success(o("message.operation.updateSuccess")),t("refresh-table"),_())}}function J(k,S){return k?k.map(K=>{const E={...S},V=jt(pa(K.action,(A,R)=>A&&!E[R]?(E[R]=!0,!0):!1)),P=J(K.children,E);return{path:K.key,actions:V,sub:P}}).filter(K=>!Ve(K.sub)||!Ve(K.actions)):[]}function le(){return{name:x.name,permissions:J(x.permissionOptions)}}return Ae(()=>i.visible,k=>{k&&Y()}),(k,S)=>{const K=ca,E=bt,V=ha,P=ga,A=Mt;return qe(),on(A,{show:r.value,"onUpdate:show":S[1]||(S[1]=R=>r.value=R),preset:"card",title:w.value,class:"w-500px"},{default:ne(()=>[D(P,{ref_key:"formRef",ref:b,"label-placement":"left","label-align":"left","label-width":"auto",model:x,rules:C},{default:ne(()=>[D(V,{cols:12,"x-gap":18},{default:ne(()=>[D(E,{span:12,label:z(o)("message.role.name"),path:"name"},{default:ne(()=>[D(K,{value:x.name,"onUpdate:value":S[0]||(S[0]=R=>x.name=R),disabled:i.type==="edit",maxlength:"30",placeholder:z(o)("message.role.placeholder")},null,8,["value","disabled","placeholder"])]),_:1},8,["label"]),D(E,{span:12,label:z(o)("message.user.permissions"),path:"permissions"},{default:ne(()=>[D(z($n),{class:"min-w-300px",animated:"","block-line":"","expand-on-click":"",selectable:!1,multiple:"",data:x.permissionOptions},null,8,["data"])]),_:1},8,["label"])]),_:1}),D(z(ye),{class:"w-full pt-16px",size:24,justify:"end"},{default:ne(()=>[D(z(me),{onClick:_},{default:ne(()=>[Pe(Le(z(o)("message.operation.cancel")),1)]),_:1}),D(z(me),{type:"primary","attr-type":"submit",onClick:j},{default:ne(()=>[Pe(Le(z(o)("message.operation.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),ja={class:"h-full overflow-hidden"};function je(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!An(e)}const il=ue({__name:"index",setup(e){const{loading:t,startLoading:i,endLoading:o}=ft(!1),{bool:d,setTrue:r}=qt(),{tableHeight:h,initTableHeight:m}=aa(),{hasPermission:u}=Vt(),{warning:y}=Wt(),{t:s}=Tn(),_=I([]),w=I([]),b=I();Kn(()=>{m(b)});function x(l){_.value=l.map(p=>(p.key=p.id,p))}const C=We({name:"",page:0,size:10}),N=(l,p=[])=>{if(l)return l.map(v=>{const q=v.actions||[];return q.push(...p),{label:v.name||v.path,key:v.path,children:N(v.sub,q),suffix:()=>{let re;return D(ye,{size:2,wrap:!1},je(re=Pn.map(se=>D(En,{style:{color:q.includes(se.key)?"#06FF6A":"#BCC3C4"},disabled:!0,class:"text-12px",icon:se.icon},null)))?re:{default:()=>[re]})}}})},O=[],F=u("WRITE","AUTHENTICATION"),Y=u("DELETE","AUTHENTICATION");if(F||Y){const l=v=>{let q;return D(me,{size:"small",disabled:v.fixed,onClick:()=>V(v)},je(q=s("message.operation.update"))?q:{default:()=>[q]})},p=v=>{let q;return D(me,{size:"small",onClick:()=>P(v.id),disabled:v.fixed},je(q=s("message.operation.delete"))?q:{default:()=>[q]})};O.push({key:"actions",title:()=>s("message.table.operation"),align:"center",width:200,render:v=>D(ye,{justify:"center"},{default:()=>[F?l(v):"",Y?p(v):""]})})}const j=I([{type:"selection",align:"center",disabled:l=>l.fixed},{key:"name",title:()=>s("message.role._value"),align:"center",resizable:!0,ellipsis:{tooltip:!0}},{key:"permissions",title:()=>s("message.user.permissions"),align:"center",resizable:!0,minWidth:200,render:l=>{if(l.permissions){let p;return D(ye,{size:"small"},je(p=l.permissions.map(v=>(v.name=s(`message.domains.${v.path}`),D(Ln,{trigger:"hover"},{trigger:()=>D(ba,{type:"primary"},{default:()=>[v.name]}),default:()=>D($n,{class:"min-w-300px",animated:!0,"block-line":!0,data:N([v]),"expand-on-click":!0,selectable:!1},null)}))))?p:{default:()=>[p]})}return""}},...O]),J=I("add"),le=I(null);function k(l){J.value=l}function S(l){w.value=l}function K(l){le.value=l}function E(){r(),k("add")}function V(l){K(l),k("edit"),r()}async function P(l){y({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var v;const{error:p}=await ta(l);p||((v=window.$message)==null||v.success(s("message.operation.deleteSuccess")),$())}})}async function A(){var l;if(Ve(w.value)){(l=window.$message)==null||l.warning(s("message.tip.noSelected"));return}y({title:s("message.tip._value"),content:s("message.operation.confirmDelete"),positiveButtonProps:{type:"primary"},positiveText:s("message.operation.confirm"),negativeText:s("message.operation.cancel"),onPositiveClick:async()=>{var v;const{error:p}=await ea(w.value);p||((v=window.$message)==null||v.success(s("message.operation.deleteSuccess")),$())}})}const R=We({page:1,pageSize:C.size,showSizePicker:!0,pageSizes:[10,15,20,25,30],onChange:l=>{R.page=l,C.page=l-1,$()},onUpdatePageSize:l=>{C.size!==l&&(R.pageSize=l,R.page=1,C.size=l,C.page=0,$())}});function H(l){R.itemCount=l.total}async function $(){i();const{data:l}=await Gt(C);l?(x(l.records),H(l)):x([]),o()}function oe(){$()}return oe(),(l,p)=>{const v=yt,q=gt,re=ht,se=la,Ge=na,Ne=Yt("permission");return qe(),Xt("div",ja,[D(Ge,{bordered:!1,class:"rounded-8px shadow-sm"},{default:ne(()=>[D(z(ye),{class:"pb-12px",justify:"space-between"},{default:ne(()=>[D(z(ye),null,{default:ne(()=>[xn((qe(),on(z(me),{type:"primary",onClick:E},{default:ne(()=>[D(v,{class:"mr-4px text-20px"}),Pe(" "+Le(z(s)("message.operation.add")),1)]),_:1})),[[Ne,["WRITE","AUTHENTICATION"]]]),xn((qe(),on(z(me),{type:"error",onClick:A},{default:ne(()=>[D(q,{class:"mr-4px text-20px"}),Pe(" "+Le(z(s)("message.operation.delete")),1)]),_:1})),[[Ne,["DELETE","AUTHENTICATION"]]])]),_:1}),D(z(ye),{align:"center",size:18},{default:ne(()=>[D(z(me),{size:"small",type:"primary",onClick:$},{default:ne(()=>[D(re,{class:Zt(["mr-4px text-16px",{"animate-spin":z(t)}])},null,8,["class"]),Pe(" "+Le(z(s)("message.table.refresh")),1)]),_:1})]),_:1})]),_:1}),D(se,{ref_key:"tableRef",ref:b,columns:j.value,data:_.value,loading:z(t),pagination:R,style:Qt({height:`${z(h)}px`}),"flex-height":"",remote:"","onUpdate:checkedRowKeys":S},null,8,["columns","data","loading","pagination","style"]),D(Ma,{visible:z(d),"onUpdate:visible":p[0]||(p[0]=ve=>Jt(d)?d.value=ve:null),type:J.value,"edit-data":le.value,onRefreshTable:$},null,8,["visible","type","edit-data"])]),_:1})])}}});export{il as default};
